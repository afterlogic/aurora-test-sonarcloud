"use strict";(self.webpackChunkafterlogic_aurora_platform=self.webpackChunkafterlogic_aurora_platform||[]).push([[5049],{r0YQ:(e,t,s)=>{e.exports=function(e){const t=s("9kOp");return s("TdEd").isModuleAvailable("FilesWebclient")&&t.isUserNormalOrTenant()?{start:function(e){const t=s("O57n");e.run("FilesWebclient","registerToolbarButtons",[t])},getFilesSharePopup:function(){return s("NCqZ")}}:null}},"h/zN":(e,t,s)=>{var i=s("p09A"),a=s("H20a"),o=s("KC/L");e.exports=function(e){this.publicId=o.pString(e.PublicId),this.groupId=o.pInt(e.GroupId),this.isAllUsersGroup=o.pBool(e.IsAll),this.isNew=o.pBool(e.New),this.contactUUID=o.pString(e.ContactUUID),this.access=i.observable(o.pInt(e.Access)),this.accessText=i.computed((function(){switch(this.access()){case Enums.SharedFileAccess.Reshare:return a.i18n("SHAREDFILES/LABEL_RESHARE_ACCESS");case Enums.SharedFileAccess.Write:return a.i18n("SHAREDFILES/LABEL_WRITE_ACCESS");case Enums.SharedFileAccess.Read:return a.i18n("SHAREDFILES/LABEL_READ_ACCESS");default:return a.i18n("SHAREDFILES/LABEL_NOSHARE_ACCESS")}}),this)}},NCqZ:(e,t,s)=>{var i=s("M4cL"),a=s("a7T2"),o=s("p09A"),n=s("H20a"),l=s("KC/L"),r=s("EFhx"),h=s("hT1I"),c=s("/QeJ"),u=s("9kOp"),d=s("o1lX"),S=s("XeMN"),p=s("TdEd"),m=s("oUN1"),E=s("skxT"),A=s("h/zN"),I=p.run("ActivityHistory","getShowHistoryPopup");function f(){d.call(this),this.fileItem=null,this.isFileEncrypted=!1,this.hintText=o.observable(""),this.accessList=o.computed((function(){return[{value:Enums.SharedFileAccess.Read,label:n.i18n("SHAREDFILES/LABEL_READ_ACCESS")},{value:Enums.SharedFileAccess.Write,label:n.i18n("SHAREDFILES/LABEL_WRITE_ACCESS")},{value:Enums.SharedFileAccess.Reshare,label:n.i18n("SHAREDFILES/LABEL_RESHARE_ACCESS")},{value:Enums.SharedFileAccess.NoAccess,label:n.i18n("SHAREDFILES/LABEL_NOSHARE_ACCESS")}]}),this),this.shares=o.observableArray([]),this.sharesScrollAreaDom=o.observable(null),this.selectedTeammateDom=o.observable(null),this.selectedTeammateDom.subscribe((function(){this.selectedTeammateDom().on("click",function(){""!==this.selectedTeammateEmail()&&(i(this.selectedTeammateDom().autocomplete("widget")).is(":visible")||this.selectedTeammateDom().autocomplete("search"))}.bind(this))}),this),this.selectedTeammateEmail=o.observable(""),this.selectedTeammateData=o.observable(null),this.selectedTeammateData.subscribe((function(){this.selectedTeammateData()&&this.selectedTeammateEmail(this.selectedTeammateData().email)}),this),this.selectAccessDom=o.observable(null),this.lastRecievedSuggestList=[],this.isSaving=o.observable(!1),this.loadingFileShares=o.observable(!1),this.bAllowShowHistory=!!I}a.extendOwn(f.prototype,d.prototype),f.prototype.PopupTemplate="SharedFiles_FilesSharePopup",f.prototype.onOpen=function(e=null,t=null){null!==e?(this.fileItem=e,e&&e.oExtendedProps,this.isFileEncrypted=!(!e.oExtendedProps||!e.oExtendedProps.InitializationVector),this.expungeFileItems=t,this.hintText(""),this.selectedTeammateEmail(""),this.selectedTeammateData(null),u.broadcastEvent("SharedFiles::OpenFilesSharePopup",{DialogHintText:this.hintText,IsDir:!e.IS_FILE}),this.fillUpShares(),this.requestFileShares(function(e,t){this.updateFileShares(e,t),this.fillUpShares()}.bind(this))):this.closePopup()},f.prototype.fillUpShares=function(){const e=this.fileItem&&this.fileItem.oExtendedProps,t=l.pArray(e&&e.Shares);this.shares(a.map(t,(function(e){return new A(e)})))},f.prototype.requestFileShares=function(e){const t=this.fileItem,s={Type:t.storageType(),Path:t.path(),Name:t.fileName()};this.loadingFileShares(!0),r.send("Files","GetExtendedProps",s,function(t,s){if(this.loadingFileShares(!1),t&&t.Result&&t.Result.Shares){const s=l.pEnum(t.Result.SharedWithMeAccess,Enums.SharedFileAccess,Enums.SharedFileAccess.NoAccess);e(s,t.Result.Shares)}else e(Enums.SharedFileAccess.NoAccess,[])}.bind(this))},f.prototype.updateFileShares=function(e,t){if(!this.fileItem)return;const s=this.fileItem.oExtendedProps;if(l.pInt(s&&s.SharedWithMeAccess)!==e&&this.fileItem.sharedWithMe()&&e===Enums.SharedFileAccess.NoAccess)return this.fileItem.deleted(!0),a.isFunction(this.expungeFileItems)&&this.expungeFileItems(),void this.closePopup();this.fileItem.updateExtendedProps({SharedWithMeAccess:e,Shares:l.pArray(t)}),this.fileItem.sharedWithMe()&&!this.fileItem.sharedWithMeAccessReshare()&&this.closePopup()},f.prototype.getCurrentShares=function(){return a.map(this.shares(),(function(e){const t=e.access();if(e.groupId)return{PublicId:e.publicId,Access:t,IsAll:e.isAllUsersGroup,IsGroup:!0,GroupId:e.groupId};{const s={PublicId:e.publicId,Access:t};return this.isFileEncrypted&&e.isNew&&(s.New=!0,s.ContactUUID=e.contactUUID),s}}),this)},f.prototype.hasChanges=function(){var e=this.fileItem,t=l.pArray(e&&e.oExtendedProps&&e.oExtendedProps.Shares),s=this.getCurrentShares();return t=a.sortBy(t,"PublicId"),s=a.sortBy(s,"PublicId"),e&&(!a.isEqual(t,s)||this.selectedTeammateEmail())},f.prototype.onEscHandler=function(){this.cancelPopup()},f.prototype.cancelPopup=function(){this.isSaving()||(this.hasChanges()?m.showPopup(S,[n.i18n("COREWEBCLIENT/CONFIRM_DISCARD_CHANGES"),function(e){e&&this.closePopup()}.bind(this)]):this.closePopup())},f.prototype.autocompleteCallback=function(e,t){const s=this.fileItem;if(!this.fileItem)return void fResponse([]);const i={storage:"team",addContactGroups:!1,addUserGroups:!this.isFileEncrypted,exceptEmail:this.fileItem.sOwnerName},o=p.run("ContactsWebclient","getSuggestionsAutocompleteCallback",[i]),l=function(e){const i=s.sOwnerName.toLowerCase();let a=this.isFileEncrypted?e.filter((e=>e.hasKey)):e;if(a=a.filter((e=>{const t=e.email.toLowerCase();return i!==t&&!this.shares().find((e=>e.publicId.toLowerCase()===t))})),this.lastRecievedSuggestList=a,a.length>0)t(a);else{const e=this.isFileEncrypted?"INFO_NO_SUGGESTED_CONTACTS_WITH_PGPKEY":"INFO_NO_SUGGESTED_CONTACTS";t([{label:n.i18n(`SHAREDFILES/${e}`),disabled:!0}])}}.bind(this);a.isFunction(o)&&(this.selectedTeammateData(null),o(e,l))},f.prototype.selectAccess=function(e,t){if(this.selectAccessDom().hasClass("expand"))this.selectAccessDom().removeClass("expand");else{if(null===this.selectedTeammateData()){var s=this.selectedTeammateEmail(),i=s.toLowerCase();if(""===s){var o=n.i18n("SHAREDFILES/WARNING_SELECT_TEAMMATE"),l=function(){this.selectedTeammateDom().focus(),this.selectedTeammateDom().autocomplete("option","minLength",0),this.selectedTeammateDom().autocomplete("search"),this.selectedTeammateDom().autocomplete("option","minLength",1)}.bind(this);m.showPopup(h,[o,l])}else{var r=a.find(this.lastRecievedSuggestList,function(e){return e.value.toLowerCase()===i||e.email.toLowerCase()===i||e.name.toLowerCase()===i}.bind(this));if(r)this.selectedTeammateData(r);else if(r=a.find(this.lastRecievedSuggestList,function(e){return-1!==e.value.toLowerCase().indexOf(i)}.bind(this))){var c=n.i18n("SHAREDFILES/CONFIRM_ADD_TEAMMATE",{EMAIL:r.email}),u=function(e){e?(this.selectedTeammateEmail(r.email),this.selectedTeammateData(r),this.selectAccessDom().addClass("expand")):(this.selectedTeammateDom().focus(),this.selectedTeammateDom().autocomplete("search"))}.bind(this),d=n.i18n("SHAREDFILES/ACTION_YES"),p=n.i18n("SHAREDFILES/ACTION_NO");m.showPopup(S,[c,u,"",d,p])}else o=n.i18n("SHAREDFILES/WARNING_NO_TEAMMATE_SELECTED",{EMAIL:s}),l=function(){this.selectedTeammateDom().focus(),this.selectedTeammateDom().autocomplete("search")}.bind(this),m.showPopup(h,[o,l])}}null!==this.selectedTeammateData()&&this.selectAccessDom().addClass("expand")}},f.prototype.addNewShare=function(e){if(!this.selectedTeammateData())return this.selectedTeammateDom().focus(),void this.selectedTeammateDom().autocomplete("search");this.shares.push(new A({PublicId:this.selectedTeammateData().email,GroupId:this.selectedTeammateData().groupId,IsAll:this.selectedTeammateData().isAllUsersGroup,ContactUUID:this.selectedTeammateData().uuid,Access:e,New:!0})),this.selectedTeammateData(null),this.selectedTeammateEmail("");var t=this.sharesScrollAreaDom(),s=null!==t?t.find(".shares_list"):null;null!==s&&t.scrollTop(s.height()-t.height())},f.prototype.deleteShare=function(e,t){t?this.shares(a.filter(this.shares(),(function(e){return e.groupId!==t}))):this.shares(a.filter(this.shares(),(function(t){return t.publicId!==e})))},f.prototype.checkAndSaveShares=function(){this.isSaving()||(this.isSaving(!0),this.requestFileShares(function(e,t){this.isSaving(!1);const s=this.fileItem;let i=s&&s.oExtendedProps,o=l.pArray(i&&i.Shares),r=l.pInt(i&&i.SharedWithMeAccess);if(t=a.sortBy(t,"PublicId"),o=a.sortBy(o,"PublicId"),a.isEqual(o,t)&&e===r)this.saveShares();else{const s=n.i18n("SHAREDFILES/WARNING_SHARES_CHANGED_BY_OTHER_USER"),i=function(){this.updateFileShares(e,t),this.fillUpShares()}.bind(this);m.showPopup(h,[s,i])}}.bind(this)))},f.prototype.saveShares=function(){if(!this.isSaving())if(this.selectedTeammateEmail()){var e=n.i18n("SHAREDFILES/CONFIRM_SAVE_SHARES_WITHOUT_LAST_EMAIL",{EMAIL:this.selectedTeammateEmail()}),t=function(e){e?this.confirmedSaveShares():setTimeout(this.selectAccess.bind(this))}.bind(this);m.showPopup(S,[e,t])}else this.confirmedSaveShares()},f.prototype.confirmedSaveShares=function(){if(!this.isSaving()){var e=this.getCurrentShares(),t={Storage:this.fileItem.storageType(),Path:this.fileItem.path(),Id:this.fileItem.id(),Shares:e,IsDir:!this.fileItem.IS_FILE},s=a.bind((function(){r.send("SharedFiles","UpdateShare",t,a.bind(this.onUpdateShareResponse,this))}),this),i=a.bind((function(){this.isSaving(!1)}),this);this.isSaving(!0),!1===u.broadcastEvent("SharedFiles::UpdateShare::before",{FileItem:this.fileItem,Shares:e,OnSuccessCallback:s,OnErrorCallback:i})&&s()}},f.prototype.onUpdateShareResponse=function(e,t){this.isSaving(!1),e.Result?this.requestFileShares(function(e,t){this.updateFileShares(e,t),E.showReport(n.i18n("SHAREDFILES/INFO_SHARING_STATUS_UPDATED")),this.fileItem=null,this.closePopup()}.bind(this)):c.showErrorByCode(e,n.i18n("SHAREDFILES/ERROR_UNKNOWN_ERROR"))},f.prototype.showHistory=function(){this.bAllowShowHistory&&m.showPopup(I,[n.i18n("SHAREDFILES/HEADING_HISTORY_POPUP"),this.fileItem])},e.exports=new f},O57n:(e,t,s)=>{var i=s("a7T2"),a=s("p09A"),o=s("H20a"),n=s("REt5"),l=s("oUN1"),r=s("hT1I"),h=s("XeMN"),c=s("NCqZ");function u(){}u.prototype.ViewTemplate="SharedFiles_ButtonsView",u.prototype.useFilesViewData=function(e){this.isShareVisible=a.computed((function(){return!e.isCorporateStorage()})),this.shareCommand=n.createCommand(this,this.executeShare.bind(this,e),e.isShareAllowed),this.selectedSharedItems=a.computed((function(){return i.filter(e.selector.listCheckedAndSelected(),(function(e){return e.sharedWithMe()}))}),this),this.selectedSharedCount=a.computed((function(){return this.selectedSharedItems().length}),this),this.isLeaveShareAllowed=a.computed((function(){return!e.isZipFolder()&&!e.sharedParentFolder()&&this.selectedSharedCount()>0&&e.allSelectedFilesReady()}),this),this.leaveShareCommand=n.createCommand(this,this.executeLeaveShare.bind(this,e),this.isLeaveShareAllowed)},u.prototype.executeShare=function(e){var t=e.selector.itemSelected();t.IS_FILE&&t.bIsSecure()&&t.oExtendedProps&&!t.oExtendedProps.ParanoidKey?l.showPopup(r,[o.i18n("SHAREDFILES/INFO_SHARING_NOT_SUPPORTED"),null,o.i18n("SHAREDFILES/TITLE_SHARE_FILE")]):l.showPopup(c,[t])},u.prototype.executeLeaveShare=function(e){var t=e.selector.listCheckedAndSelected()||[],s=this.selectedSharedItems(),a=this.selectedSharedCount();if(!e.bPublic||a>0){var n,r=t.length!==a,c=!!i.find(s,(function(e){return!e.IS_FILE})),u=!!i.find(s,(function(e){return e.IS_FILE}));n=r?o.i18n("SHAREDFILES/CONFIRM_NOT_ALL_ITEMS_SHARED"):c&&u?o.i18n("SHAREDFILES/CONFIRM_LEAVE_ITEMS_SHARE"):c?o.i18n("SHAREDFILES/CONFIRM_LEAVE_FOLDERS_SHARE_PLURAL",{NAME:s[0].fileName()},null,a):o.i18n("SHAREDFILES/CONFIRM_LEAVE_FILES_SHARE_PLURAL",{NAME:s[0].fileName()},null,a),e.selector.useKeyboardKeys(!1),l.showPopup(h,[n,function(t){t&&e.deleteItems(s,!0,"LeaveShare")},"",o.i18n("SHAREDFILES/ACTION_LEAVE_SHARE")])}},e.exports=new u}}]);