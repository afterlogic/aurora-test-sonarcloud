(self.webpackChunkafterlogic_aurora_platform=self.webpackChunkafterlogic_aurora_platform||[]).push([[2620],{H2Cq:(t,e,i)=>{"use strict";const o=i("a7T2"),n={setCursorAtTheEnd:function(t){if(document.createRange){const e=document.createRange();e.selectNodeContents(t),e.collapse(!1);const i=window.getSelection();i.removeAllRanges(),i.addRange(e),t.focus(),e.detach()}},getSelectionRanges:function(){const t=[];if(window.getSelection){const e=window.getSelection(),i=e.rangeCount;for(let o=0;o<i;o++)t.push(e.getRangeAt(o))}return t},setSelectionRanges:function(t,e=!1){let i="";if(window.getSelection&&o.isArray(t)){const o=t.length,n=window.getSelection();n.removeAllRanges();for(let s=0;s<o;s++){const o=t[s];o&&(n.addRange(o),i+=o,e&&o.collapse(!1))}}return i}};t.exports=n},C5H3:(t,e,i)=>{var o=i("p09A"),n=i("W66n");function s(t){this.sName="",this.visible=o.observable(!0),this.baseHash=o.observable(""),this.hash=o.observable(""),this.linkText=o.observable(t),this.isCurrent=o.observable(!1),this.recivedAnim=o.observable(!1).extend({autoResetToFalse:500}),this.unseenCount=o.observable(0),this.allowChangeTitle=o.observable(!1),this.inactiveTitle=o.observable(""),this.excludedHashes=o.observableArray([])}s.prototype.ViewTemplate="CoreWebclient_HeaderItemView",s.prototype.setName=function(t){this.sName=t.toLowerCase(),""===this.baseHash()?(this.hash(n.buildHashFromArray([t.toLowerCase()])),this.baseHash(this.hash())):this.hash(this.baseHash())},t.exports=s},atfJ:(t,e,i)=>{"use strict";var o=i("EFhx"),n=i("XaJJ");t.exports={send:function(t,e,i,s,a){o.send(a||n.ServerModuleName,t,e,i,s)}}},XaJJ:(t,e,i)=>{"use strict";var o=i("a7T2"),n=i("KC/L");t.exports={ServerModuleName:"RocketChatWebclient",HashModuleName:"chat",ChatUrl:"",AllowAddMeetingLinkToEvent:!1,MeetingLinkUrl:"",init:function(t){var e=t.RocketChatWebclient;o.isEmpty(e)||(this.ChatUrl=n.pString(e.ChatUrl),this.AllowAddMeetingLinkToEvent=n.pBool(e.AllowAddMeetingLinkToEvent),this.MeetingLinkUrl=n.pString(e.MeetingLinkUrl))}}},W0SK:(t,e,i)=>{"use strict";var o=i("M4cL");t.exports=function(t){var e=i("p09A"),n=i("9kOp"),s=i("H20a"),a=i("XaJJ"),r=i("mGms"),c=[],h=null;a.init(t);var l=a.AppName?s.getUrlFriendlyName(a.AppName):a.HashModuleName;if(n.isUserNormalOrTenant()){var u={getScreens:function(){var t={};return t[a.HashModuleName]=function(){return i("tW/3")},t}};return n.isNewTab()||(n.subscribeEvent("CalendarWebclient::RegisterEditEventController",(function({register:t,view:e}){const o=i("CSAE");o.init(e),t(o,"AdditionalButton")})),u.start=function(t){i("skxT").initHiddenView(a.HashModuleName),""!==a.ChatUrl&&t.run("SettingsWebclient","registerSettingsTab",[function(){return i("/f+x")},a.HashModuleName,s.i18n("ROCKETCHATWEBCLIENT/LABEL_SETTINGS_TAB")]),n.subscribeEvent("Logout",(function(){o.removeCookie("RocketChatAuthToken"),o.removeCookie("RocketChatUserId"),o("#rocketchat_iframe")&&(o("#rocketchat_iframe").hide(),o("#rocketchat_iframe").get(0).contentWindow.postMessage({externalCommand:"logout"},"*"))})),""!==a.ChatUrl&&n.subscribeEvent("ContactsWebclient::AddCustomCommand",(function(t){t.Callback({Text:s.i18n("ROCKETCHATWEBCLIENT/ACTION_CHAT_WITH_CONTACT"),CssClass:"chat",Handler:function(){var t=c[this.uuid()];if(t&&!t.closed)t.focus();else{var e=window.screen.width,i=Math.ceil((e-360)/2),o=window.screen.height,n=Math.ceil((o-600)/2),s="?chat-direct="+this.uuid()+"&"+(new Date).getTime(),a=",width=360,height=600,top="+n+",left="+i;(t=r.open(s,"Chat",!1,a))&&(c[this.uuid()]=t)}},Visible:e.computed((function(){return t.Contact.team()&&!t.Contact.itsMe()}))})}))},u.getHeaderItem=function(){if(null===h&&(h=i("pRXq")),""!==a.ChatUrl)return{item:h,name:l}}),u}return null}},CSAE:(t,e,i)=>{"use strict";const o=i("p09A"),n=i("H2Cq"),s=i("REt5"),a=i("XaJJ");function r(){this.meetingLinkUrl=a.MeetingLinkUrl.replace(/[^\/]$/,"$&/"),this.allowAddMeetingLink=a.AllowAddMeetingLinkToEvent&&0!==a.MeetingLinkUrl.length,this.focusedDom=o.observable(null)}r.prototype.ViewTemplate="RocketChatWebclient_AddMeetingLinkToEventView",r.prototype.init=function(t){this.isEditable=t.descriptionView.isEditable,this.descriptionDom=t.descriptionView.dataDom,this.descriptionHtml=t.descriptionView.dataHtml,this.descriptionFocus=t.descriptionView.dataFocus,this.descriptionFocus.subscribe((function(){this.descriptionFocus()?this.focusedDom(this.descriptionDom()):(this.savedRanges=n.getSelectionRanges(),setTimeout(function(){this.descriptionFocus()||this.locationFocus()||this.focusedDom(null)}.bind(this),100))}),this),this.locationDom=t.locationView.dataDom,this.locationHtml=t.locationView.dataHtml,this.locationFocus=t.locationView.dataFocus,this.locationFocus.subscribe((function(){this.locationFocus()?this.focusedDom(this.locationDom()):setTimeout(function(){this.descriptionFocus()||this.locationFocus()||this.focusedDom(null)}.bind(this),100)}),this)},r.prototype.addMeetingLink=function(){const t=`${this.meetingLinkUrl}${s.getRandomHash(32)}`,e=`<a href="${t}">${t}</a>`;this.focusedDom()?(n.setSelectionRanges(this.savedRanges,!0),this.focusedDom().focus(),window.document.execCommand("insertHTML",!1,e)):(n.setCursorAtTheEnd(this.locationDom()[0]),window.document.execCommand("insertHTML",!1,e)),this.descriptionFocus()?this.descriptionHtml(this.descriptionDom().html()):this.locationFocus()&&this.locationHtml(this.locationDom().html())},t.exports=new r},pRXq:(t,e,i)=>{"use strict";var o=i("a7T2"),n=i("p09A"),s=i("H20a"),a=i("KC/L"),r=i("atfJ"),c=i("C5H3"),h=i("mGms");function l(){c.call(this,s.i18n("ROCKETCHATWEBCLIENT/ACTION_SHOW_CHAT")),this.iAutoCheckMailTimer=-1,this.unseenCount=n.observable(0),this.mainHref=n.computed((function(){return this.hash()}),this),this.getUnreadCounter()}l.prototype.getUnreadCounter=function(){r.send("GetUnreadCounter",{},(function(t){this.unseenCount(a.pInt(t.Result))}),this)},l.prototype.onChatClick=function(t,e){h.open("?chat","Chat")},o.extendOwn(l.prototype,c.prototype),l.prototype.ViewTemplate="RocketChatWebclient_HeaderItemView";var u=new l;u.allowChangeTitle(!0),t.exports=u},"tW/3":(t,e,i)=>{"use strict";var o=i("a7T2"),n=i("p09A"),s=i("KC/L"),a=i("REt5"),r=i("EFhx"),c=i("doeu"),h=i("W66n"),l=i("OfVV"),u=i("XaJJ");function d(){c.call(this,"RocketChatWebclient"),this.bInitialized=!1,this.sChatUrl=u.ChatUrl,this.iframeDom=n.observable(null),this.iframeLoaded=n.observable(!1),this.chatToken=n.observable(""),n.computed((function(){this.iframeDom()&&this.iframeLoaded()&&this.chatToken()&&this.init(this.chatToken())}),this),r.send(u.ServerModuleName,"InitChat",{},(function(t){t.Result&&t.Result.authToken&&this.chatToken(t.Result.authToken)}),this)}o.extendOwn(d.prototype,c.prototype),d.prototype.ViewTemplate="RocketChatWebclient_MainView",d.prototype.ViewConstructorName="CMainView",d.prototype.onFrameLoad=function(){this.iframeLoaded(!0)},d.prototype.init=function(t){if(!this.bInitialized){var e=this.iframeDom()[0];function o(){e.contentWindow.postMessage({externalCommand:"login-with-token",token:t},"*")}window.addEventListener("message",function(t){t&&t.data&&(console.log("iframe message:",t.data.eventName),"startup"===t.data.eventName&&setTimeout(o,500),"notification"===t.data.eventName&&this.showNotification(t.data.data.notification),"unread-changed"===t.data.eventName)&&i("pRXq").unseenCount(s.pInt(t.data.data))}.bind(this)),this.setAuroraThemeToRocketChat(e),this.bInitialized=!0}},d.prototype.setAuroraThemeToRocketChat=function(t){function e(){t.contentWindow.postMessage({externalCommand:"set-aurora-theme",theme:l.Theme},"*")}setTimeout(e,500),setTimeout(e,1e3),setTimeout(e,2e3)},d.prototype.showNotification=function(t){const e={action:"show",icon:this.sChatUrl+"avatar/"+t.payload.sender.username+"?size=50&format=png",title:t.title,body:t.text,callback:function(){window.focus(),this.shown()||h.setHash([u.HashModuleName]);var e="";switch(t.payload.type){case"c":e="/channel/"+t.payload.name;break;case"d":e="/direct/"+t.payload.rid;break;case"p":e="/group/"+t.payload.name}e&&this.iframeDom()[0].contentWindow.postMessage({externalCommand:"go",path:e},"*")}.bind(this)};a.desktopNotify(e)},t.exports=new d},"/f+x":(t,e,i)=>{"use strict";var o=i("9kOp"),n=i("atfJ"),s=i("H20a"),a=i("XaJJ"),r=i("OfVV");function c(){this.sAppName=a.AppName||s.i18n("ROCKETCHATWEBCLIENT/LABEL_SETTINGS_TAB"),this.server=a.ChatUrl,this.bDemo=r.IsDemo,this.sDownloadLink="https://www.rocket.chat/download-apps",this.credentialsHintText=o.mobileCredentialsHintText}c.prototype.getLoginForCurrentUser=function(){n.send("GetLoginForCurrentUser",{},(function(t){this.sLogin(t.Result)}),this)},c.prototype.ViewTemplate="RocketChatWebclient_RocketChatSettingsPaneView",t.exports=new c}}]);