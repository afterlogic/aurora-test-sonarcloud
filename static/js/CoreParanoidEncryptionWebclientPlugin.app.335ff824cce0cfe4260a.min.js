/*! For license information please see CoreParanoidEncryptionWebclientPlugin.app.335ff824cce0cfe4260a.min.js.LICENSE.txt */
(self.webpackChunkafterlogic_aurora_platform=self.webpackChunkafterlogic_aurora_platform||[]).push([[5937],{"Cox/":function(t,e,n){var r,o=o||function(t){"use strict";if(!(void 0===t||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var e=t.document,n=function(){return t.URL||t.webkitURL||t},r=e.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in r,i=/constructor/i.test(t.HTMLElement)||t.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent),s=function(e){(t.setImmediate||t.setTimeout)((function(){throw e}),0)},u=function(t){setTimeout((function(){"string"==typeof t?n().revokeObjectURL(t):t.remove()}),4e4)},c=function(t){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t},l=function(e,l,h){h||(e=c(e));var p,f=this,y="application/octet-stream"===e.type,d=function(){!function(t,e){for(var n=(e=[].concat(e)).length;n--;){var r=t["on"+e[n]];if("function"==typeof r)try{r.call(t,t)}catch(t){s(t)}}}(f,"writestart progress write writeend".split(" "))};if(f.readyState=f.INIT,o)return p=n().createObjectURL(e),void setTimeout((function(){var t,e;r.href=p,r.download=l,t=r,e=new MouseEvent("click"),t.dispatchEvent(e),d(),u(p),f.readyState=f.DONE}));!function(){if((a||y&&i)&&t.FileReader){var r=new FileReader;return r.onloadend=function(){var e=a?r.result:r.result.replace(/^data:[^;]*;/,"data:attachment/file;");t.open(e,"_blank")||(t.location.href=e),e=void 0,f.readyState=f.DONE,d()},r.readAsDataURL(e),void(f.readyState=f.INIT)}p||(p=n().createObjectURL(e)),y?t.location.href=p:t.open(p,"_blank")||(t.location.href=p),f.readyState=f.DONE,d(),u(p)}()},h=l.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(t,e,n){return e=e||t.name||"download",n||(t=c(t)),navigator.msSaveOrOpenBlob(t,e)}:(h.abort=function(){},h.readyState=h.INIT=0,h.WRITING=1,h.DONE=2,h.error=h.onwritestart=h.onprogress=h.onwrite=h.onabort=h.onerror=h.onwriteend=null,function(t,e,n){return new l(t,e||t.name||"download",n)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);t.exports?t.exports.saveAs=o:null!==n.amdD&&null!==n.amdO&&(void 0===(r=function(){return o}.call(e,n,e,t))||(t.exports=r))},"/dxK":(t,e,n)=>{"use strict";function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function o(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return i(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function a(){a=function(){return e};var t,e={},n=Object.prototype,o=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function h(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(t){h=function(t,e,n){return t[e]=n}}function p(t,e,n,r){var o=e&&e.prototype instanceof m?e:m,a=Object.create(o.prototype),s=new A(r||[]);return i(a,"_invoke",{value:I(t,n,s)}),a}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=p;var y="suspendedStart",d="suspendedYield",v="executing",b="completed",g={};function m(){}function E(){}function w(){}var C={};h(C,u,(function(){return this}));var P=Object.getPrototypeOf,k=P&&P(P(T([])));k&&k!==n&&o.call(k,u)&&(C=k);var N=w.prototype=m.prototype=Object.create(C);function O(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function n(i,a,s,u){var c=f(t[i],t,a);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==r(h)&&o.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,s,u)}),(function(t){n("throw",t,s,u)})):e.resolve(h).then((function(t){l.value=t,s(l)}),(function(t){return n("throw",t,s,u)}))}u(c.arg)}var a;i(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return a=a?a.then(o,o):o()}})}function I(e,n,r){var o=y;return function(i,a){if(o===v)throw Error("Generator is already running");if(o===b){if("throw"===i)throw a;return{value:t,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var u=L(s,r);if(u){if(u===g)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===y)throw o=b,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=v;var c=f(e,n,r);if("normal"===c.type){if(o=r.done?b:d,c.arg===g)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(o=b,r.method="throw",r.arg=c.arg)}}}function L(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,L(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var i=f(o,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function R(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function S(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(R,this),this.reset(!0)}function T(e){if(e||""===e){var n=e[u];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function n(){for(;++i<e.length;)if(o.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}throw new TypeError(r(e)+" is not iterable")}return E.prototype=w,i(N,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:E,configurable:!0}),E.displayName=h(w,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===E||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,h(t,l,"GeneratorFunction")),t.prototype=Object.create(N),t},e.awrap=function(t){return{__await:t}},O(x.prototype),h(x.prototype,c,(function(){return this})),e.AsyncIterator=x,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new x(p(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(N),h(N,l,"Generator"),h(N,u,(function(){return this})),h(N,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=T,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(S),!e)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var u=o.call(a,"catchLoc"),c=o.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),S(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;S(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:T(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),g}},e}function s(t,e,n,r,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,o)}function u(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){s(i,r,o,a,u,"next",t)}function u(t){s(i,r,o,a,u,"throw",t)}a(void 0)}))}}var c=n("M4cL"),l=n("a7T2"),h=n("TdEd"),p=n("skxT"),f=n("H20a"),y=n("Cox/"),d=n("0+zD"),v=n("REt5"),b=n("Zukw"),g=n("oUN1"),m=n("A2fR"),E=n("PnO4"),w=n("AgXX"),C=h.run("OpenPgpWebclient","getOpenPgpEncryptor");function P(){this.iChunkNumber=0,this.iChunkSize=1024*w.ChunkSizeMb*1024,this.iCurrChunk=0,this.oChunk=null,this.iv=null,this.oChunkQueue={isProcessed:!1,privateKeyPassword:"",aFiles:[]},this.aStopList=[],this.fOnUploadCancelCallback=null,this.oKey=null}function k(t,e,n,r,o){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this.oWriter=new O(t.fileName(),r),this.init(t,e,n,o,i)}function N(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.oWriter=null,this.init(t,e,n,null,r)}function O(t,e){this.sName=t,this.aBuffer=[],l.isFunction(e)&&(this.fProcessBlobCallback=e)}function x(t){this.sName=t,this.aBuffer=[],this.imgWindow=window.open("","_blank","height=auto, width=auto,toolbar=no,scrollbars=no,resizable=yes")}P.prototype.start=function(){var t=u(a().mark((function t(e){var n,r=arguments;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=r.length>1&&void 0!==r[1]?r[1]:"",this.oFileInfo=e,this.oFile=e.File,this.iChunkNumber=Math.ceil(e.File.size/this.iChunkSize),this.iCurrChunk=0,this.oChunk=null,this.iv=window.crypto.getRandomValues(new Uint8Array(16)),this.oFileInfo.Hidden={RangeType:1,Overwrite:!0},this.oFileInfo.Hidden.ExtendedProps={InitializationVector:b.Array2HexString(new Uint8Array(this.iv))},n&&(this.oFileInfo.Hidden.ExtendedProps.ParanoidKey=n);case 10:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),P.prototype.startUpload=function(){var t=u(a().mark((function t(e,n,r,o){var i,s,u;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.oChunkQueue.isProcessed=!0,t.next=3,d.generateKey();case 3:return this.oKey=t.sent,t.next=6,d.convertKeyToString(this.oKey);case 6:return i=t.sent,t.next=9,C.getCurrentUserPrivateKey();case 9:if(!t.sent||!i){t.next=30;break}return t.next=13,C.getCurrentUserPublicKey();case 13:if(!(s=t.sent)){t.next=27;break}return t.next=17,this.encryptParanoidKey(i,[s]);case 17:if(!(u=t.sent)){t.next=24;break}return t.next=21,this.start(e,u);case 21:this.readChunk(n,r),t.next=25;break;case 24:l.isFunction(o)&&o();case 25:t.next=28;break;case 27:l.isFunction(o)&&o();case 28:t.next=31;break;case 30:l.isFunction(o)&&o();case 31:case"end":return t.stop()}}),t,this)})));return function(e,n,r,o){return t.apply(this,arguments)}}(),P.prototype.readChunk=function(t,e){var n=this.iChunkSize*this.iCurrChunk,r=this.iCurrChunk<this.iChunkNumber-1?this.iChunkSize*(this.iCurrChunk+1):this.oFile.size,o=new FileReader,i=null;if(-1!==this.aStopList.indexOf(t))return this.aStopList.splice(this.aStopList.indexOf(t),1),void this.checkQueue();if(this.oFile.slice?i=this.oFile.slice(n,r):this.oFile.webkitSlice?i=this.oFile.webkitSlice(n,r):this.oFile.mozSlice&&(i=this.oFile.mozSlice(n,r)),i)try{o.onloadend=l.bind((function(n){n.target.readyState===FileReader.DONE&&(this.oChunk=n.target.result,this.iCurrChunk++,this.encryptChunk(t,e))}),this),o.readAsArrayBuffer(i)}catch(t){p.showError(f.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_ENCRYPTION"))}},P.prototype.encryptChunk=function(t,e){crypto.subtle.encrypt({name:"AES-CBC",iv:this.iv},this.oKey,this.oChunk).then(l.bind((function(n){n=this.iChunkNumber>1&&this.iCurrChunk!==this.iChunkNumber?n.slice(0,n.byteLength-16):n;var r=new Blob([n],{type:"text/plain",lastModified:new Date}),o=l.bind((function(t,e){this.iCurrChunk<this.iChunkNumber?this.readChunk(t,e):(this.oChunkQueue.isProcessed=!1,this.checkQueue())}),this);this.oFileInfo.File=r,this.iv=new Uint8Array(n.slice(n.byteLength-16)),1===this.iCurrChunk?this.oFileInfo.Hidden.ExtendedProps.FirstChunk=!0:this.oFileInfo.Hidden.ExtendedProps.FirstChunk=null,this.iCurrChunk==this.iChunkNumber?this.oFileInfo.Hidden.ExtendedProps.Loading=null:this.oFileInfo.Hidden.ExtendedProps.Loading=!0,e(t,this.oFileInfo,o,this.iCurrChunk,this.iChunkNumber,(this.iCurrChunk-1)*this.iChunkSize)}),this)).catch((function(t){p.showError(f.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_ENCRYPTION"))}))},P.prototype.downloadDividedFile=function(){var t=u(a().mark((function t(e,n,r,o){var i,s,u=arguments;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=u.length>4&&void 0!==u[4]?u[4]:"",e.startDownloading(),t.next=4,this.prepareKey(e,i);case 4:!1!==(s=t.sent)?new k(e,n,this.iChunkSize,r,o,s):e.stopDownloading();case 6:case"end":return t.stop()}}),t,this)})));return function(e,n,r,o){return t.apply(this,arguments)}}(),P.prototype.prepareKey=function(){var t=u(a().mark((function t(e){var n,r,o=arguments;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r="",!(n=o.length>1&&void 0!==o[1]?o[1]:"")){t.next=10;break}return t.next=5,this.decryptParanoidKey(n);case 5:if(r=t.sent){t.next=8;break}return t.abrupt("return",!1);case 8:t.next=22;break;case 10:if(w.DontRemindMe()){t.next=16;break}return t.next=13,this.showOutdatedEncryptionMethodPopup(e.fileName());case 13:if(t.sent){t.next=16;break}return t.abrupt("return",!1);case 16:if(this.isKeyInStorage()){t.next=22;break}return t.next=19,this.getTemporaryKeyAsString();case 19:if(r=t.sent){t.next=22;break}return t.abrupt("return",!1);case 22:return t.abrupt("return",r);case 23:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),P.prototype.getTemporaryKeyAsString=u(a().mark((function t(){var e,n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=new Promise((function(t,e){g.showPopup(E,[function(e){t(e)},function(){t(!1)}])})),t.next=3,e;case 3:return n=t.sent,t.abrupt("return",n);case 5:case"end":return t.stop()}}),t)}))),P.prototype.showOutdatedEncryptionMethodPopup=function(){var t=u(a().mark((function t(e){var n,r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new Promise((function(t,n){g.showPopup(m,[e,function(){t(!0)},function(){t(!1)}])})),t.next=3,n;case 3:return r=t.sent,t.abrupt("return",r);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),P.prototype.encryptParanoidKey=function(){var t=u(a().mark((function t(e,n){var r,o,i,s,u,c,l,h=arguments;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return""===(r=h.length>2&&void 0!==h[2]?h[2]:"")&&(r=this.oChunkQueue.privateKeyPassword),o="",t.next=5,C.getCurrentUserPrivateKey();case 5:if(!(i=t.sent)){t.next=11;break}return t.next=9,C.encryptData(e,n,[i],!1,!0,r);case 9:(s=t.sent).result?(u=s.result,c=u.data,l=u.passphrase,this.oChunkQueue.privateKeyPassword=l,o=c):(s.hasErrors()||s.hasNotices())&&C.showPgpErrorByCode(s,"",f.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY"));case 11:return t.abrupt("return",o);case 12:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}(),P.prototype.decryptParanoidKey=function(){var t=u(a().mark((function t(e){var n,r,i,s,u,c,h,y=arguments;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=y.length>1&&void 0!==y[1]?y[1]:"",r="",t.next=4,C.decryptData(e,n);case 4:if(!(i=t.sent).result){t.next=17;break}if(r=i.result,!i.validKeyNames||!i.validKeyNames.length){t.next=14;break}return t.next=10,C.getCurrentUserPrivateKey();case 10:(s=t.sent)&&i.validKeyNames.includes(s.getUser())||(u=f.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/REPORT_SUCCESSFULL_SIGNATURE_VERIFICATION")+i.validKeyNames.join(", ").replace(/</g,"&lt;").replace(/>/g,"&gt;"),p.showReport(u)),t.next=15;break;case 14:i.notices&&-1!==l.indexOf(i.notices,Enums.OpenPgpErrors.VerifyErrorNotice)&&p.showError(f.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_SIGNATURE_NOT_VERIFIED"));case 15:t.next=18;break;case 17:(i.hasErrors()||i.hasNotices())&&(c=i.errors?i.errors:[],h=i.notices?i.notices:[],[].concat(o(c),o(h)).some((function(t){return t.length&&t[0]===Enums.OpenPgpErrors.PrivateKeyNotFoundError}))?p.showError(f.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_NO_PRIVATE_KEY_FOUND_FOR_DECRYPT")):C.showPgpErrorByCode(i,"",f.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")));case 18:return t.abrupt("return",r);case 19:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),P.prototype.checkQueue=function(){var t=null;this.oChunkQueue.aFiles.length>0?(t=this.oChunkQueue.aFiles.shift()).fStartUploadCallback.apply(t.fStartUploadCallback,[t.oFileInfo,t.sUid,t.fOnChunkEncryptCallback]):this.oChunkQueue.privateKeyPassword=""},P.prototype.stopUploading=function(t,e,n){var r=!1;this.oChunkQueue.aFiles.forEach((function(n,o,i){n.sUid===t&&(e(t,n.oFileInfo.FileName),i.splice(o,1),r=!0)})),r||(this.aStopList.push(t),this.oChunkQueue.isProcessed=!1,e(t,n),this.oKey=null)},P.prototype.viewEncryptedImage=function(){var t=u(a().mark((function t(e,n){var r,o,i=arguments;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=i.length>2&&void 0!==i[2]?i[2]:"",e.startDownloading(),t.next=4,this.prepareKey(e,r);case 4:!1!==(o=t.sent)?new N(e,n,this.iChunkSize,o):e.stopDownloading();case 6:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}(),P.prototype.isKeyInStorage=function(){return!!d.loadKeyFromStorage()},k.prototype.init=function(){var t=u(a().mark((function t(e,n,r,o,i){var s,u,c=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.sHash=v.getRandomHash(),this.oFile=e,this.sFileName=e.fileName(),this.iFileSize=e.size(),this.sDownloadLink=e.getActionUrl("download"),this.iCurrChunk=0,this.iv=new Uint8Array(b.HexString2Array(n)),this.key=null,this.iChunkNumber=Math.ceil(this.iFileSize/r),this.iChunkSize=r,this.fProcessBlobErrorCallback=o,this.sDownloadLink.indexOf("&")>0&&(this.sDownloadLink=this.sDownloadLink.substring(0,this.sDownloadLink.indexOf("&"))),s=function(){l.isFunction(c.fProcessBlobErrorCallback)&&c.fProcessBlobErrorCallback(),c.stopDownloading()},!i){t.next=20;break}return t.next=16,d.getKeyFromString(i);case 16:(u=t.sent)?(this.key=u,this.decryptChunk()):s(),t.next=21;break;case 20:d.getKey((function(t){c.key=t,c.decryptChunk()}),s);case 21:case"end":return t.stop()}}),t,this)})));return function(e,n,r,o,i){return t.apply(this,arguments)}}(),k.prototype.writeChunk=function(t){!0===this.oFile.downloading()&&(this.oWriter.write(t),this.iCurrChunk<this.iChunkNumber?this.decryptChunk():(this.stopDownloading(),this.oWriter.close()))},k.prototype.decryptChunk=function(){var t=new XMLHttpRequest;t.open("GET",this.getChunkLink(),!0),t.responseType="arraybuffer",t.onprogress=l.bind((function(e){this.isDownloading()?this.oFile.onDownloadProgress(e.loaded+(this.iCurrChunk-1)*this.iChunkSize,this.iFileSize):t.abort()}),this),t.onload=l.bind((function(e){var n=t.response,r={};200===t.status&&n&&((r=new Uint8Array(n.byteLength+16)).set(new Uint8Array(n),0),this.iCurrChunk!==this.iChunkNumber?crypto.subtle.encrypt({name:"AES-CBC",iv:new Uint8Array(n.slice(n.byteLength-16))},this.key,new Uint8Array([16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16]).buffer).then(l.bind((function(t){r.set(new Uint8Array(new Uint8Array(t.slice(0,16))),n.byteLength),crypto.subtle.decrypt({name:"AES-CBC",iv:this.iv},this.key,r.buffer).then(l.bind((function(t){var e=new Uint8Array(t);this.iv=new Uint8Array(n.slice(n.byteLength-16)),this.writeChunk(e)}),this)).catch(l.bind((function(t){this.stopDownloading(),l.isFunction(this.fProcessBlobErrorCallback)&&this.fProcessBlobErrorCallback(),p.showError(f.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_DECRYPTION"))}),this))}),this)):crypto.subtle.decrypt({name:"AES-CBC",iv:this.iv},this.key,n).then(l.bind((function(t){var e=new Uint8Array(t);this.iv=new Uint8Array(n.slice(n.byteLength-16)),this.writeChunk(e)}),this)).catch(l.bind((function(t){this.stopDownloading(),l.isFunction(this.fProcessBlobErrorCallback)&&this.fProcessBlobErrorCallback(),p.showError(f.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_DECRYPTION"))}),this)))}),this),t.send(null)},k.prototype.stopDownloading=function(){this.oFile.stopDownloading()},k.prototype.getChunkLink=function(){return this.sDownloadLink+"/download/"+this.iCurrChunk+++"/"+this.iChunkSize+"&"+this.sHash},k.prototype.isDownloading=function(){return this.oFile.downloading()},N.prototype=Object.create(k.prototype),N.prototype.constructor=N,N.prototype.writeChunk=function(t){this.oWriter=null===this.oWriter?new x(this.sFileName):this.oWriter,this.oWriter.write(t),this.iCurrChunk<this.iChunkNumber?this.decryptChunk():(this.stopDownloading(),this.oWriter.close())},O.prototype.write=function(t){this.aBuffer.push(t)},O.prototype.close=function(){var t=new Blob(this.aBuffer);void 0!==this.fProcessBlobCallback?this.fProcessBlobCallback(t):y.saveAs(t,this.sName),t=null},x.prototype=Object.create(O.prototype),x.prototype.constructor=x,x.prototype.close=function(){try{var t=new Blob(this.aBuffer),e=window.URL.createObjectURL(t);this.imgWindow.document.write("<head><title>"+this.sName+'</title></head><body><img src="'+e+'" /></body>'),c(this.imgWindow.document.body).find("img").on("load",(function(){window.URL.revokeObjectURL(e)}))}catch(t){p.showError(f.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_POPUP_WINDOWS"))}},t.exports=new P},AgXX:(t,e,n)=>{"use strict";var r=n("p09A"),o=n("a7T2"),i=n("KC/L");t.exports={ServerModuleName:"CoreParanoidEncryptionWebclientPlugin",HashModuleName:"paranoid-encryption",EncryptionAllowedModules:["Files"],EncryptionAllowedStorages:["personal"],enableJscrypto:r.observable(!0),EnableInPersonalStorage:!1,ChunkSizeMb:5,AllowMultiChunkUpload:!0,AllowChangeSettings:!1,DontRemindMe:r.observable(!1),init:function(t){var e=o.extend({},t[this.ServerModuleName]||{},t.CoreParanoidEncryptionWebclientPlugin||{});o.isEmpty(e)||(this.enableJscrypto(i.pBool(e.EnableModule,this.enableJscrypto())),this.DontRemindMe(i.pBool(e.DontRemindMe,this.DontRemindMe())),this.EnableInPersonalStorage=i.pBool(e.EnableInPersonalStorage,this.EnableInPersonalStorage),this.ChunkSizeMb=i.pInt(e.ChunkSizeMb,this.ChunkSizeMb),this.AllowMultiChunkUpload=i.pBool(e.AllowMultiChunkUpload,this.AllowMultiChunkUpload),this.AllowChangeSettings=i.pBool(e.AllowChangeSettings,this.AllowChangeSettings))},update:function(t,e){this.enableJscrypto(t),this.EnableInPersonalStorage=e}}},sJkT:(t,e,n)=>{"use strict";var r=n("a7T2"),o=n("H20a"),i=n("REt5"),a=n("EFhx"),s=n("9kOp"),u=n("dfnr"),c=n("skxT"),l=n("oUN1"),h=n("XeMN"),p=n("/ktp"),f=n("gE/T"),y=n("mwH5"),d=n("AgXX"),v=null,b=[],g=!1,m=null;function E(){return"https:"===window.location.protocol}function w(t){t.run("SettingsWebclient","registerSettingsTab",[function(){return n("No2m")},d.HashModuleName,o.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/LABEL_SETTINGS_TAB")]),s.subscribeEvent("AbstractFileModel::FileDownload::before",(function(t){if(t.File&&t.File.IS_FILE){var e=t.File,n=(null==e?void 0:e.oExtendedProps)||!1,r=(null==n?void 0:n.InitializationVector)||!1,i=(null==n?void 0:n.ParanoidKey)||!1,a=(null==n?void 0:n.ParanoidKeyShared)||!1,u=e.sOwnerName===s.getUserPublicId(),l=e.sharedWithMe();d.enableJscrypto()&&r&&(u||l)&&(E()?t.CustomDownloadHandler=function(){v.downloadDividedFile(e,r,null,null,l&&a?a:i)}:(c.showError(o.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_HTTPS_NEEDED")),t.CancelDownload=!0))}})),s.subscribeEvent("Jua::FileUpload::before",(function(t){var e=t.sUid,n=t.sModuleName,i=t.oFileInfo,a=t.fOnChunkReadyCallback,s=t.fRegularUploadFileCallback,u=t.fCancelFunction,h=function(t,e,n){!d.AllowMultiChunkUpload&&t.File.size>v.iChunkSize?(c.showError(o.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_FILE_SIZE_LIMIT",{VALUE:d.ChunkSizeMb})),u(e),v.oChunkQueue.isProcessed=!1,v.checkQueue()):v.startUpload(t,e,n,r.bind((function(){u(e),v.oChunkQueue.isProcessed=!1,v.checkQueue()}),this))},y=r.bind((function(){b.forEach((function(t){s(t.sUid,t.oFileInfo)})),b=[],g=!1}),this),m=r.bind((function(){b.forEach((function(t){v.oChunkQueue.aFiles.push({fStartUploadCallback:h,oFileInfo:t.oFileInfo,sUid:t.sUid,fOnChunkEncryptCallback:a})})),b=[],g=!1,v.oChunkQueue.isProcessed||(v.oChunkQueue.isProcessed=!0,v.checkQueue())})),w=r.bind((function(){b.forEach((function(t){u(t.sUid)})),b=[],g=!1}));d.enableJscrypto()&&d.EncryptionAllowedModules&&d.EncryptionAllowedModules.length>0&&d.EncryptionAllowedModules.includes(n)&&("encrypted"===t.sStorageType||"personal"===t.sStorageType&&d.EnableInPersonalStorage)?E()?!i.EncryptWithoutConfirm&&"personal"===t.sStorageType&&d.EnableInPersonalStorage?(g||(setTimeout((function(){l.showPopup(p,[m,y,w,b.length,r.map(b,(function(t){return t.oFileInfo.FileName}))])}),10),g=!0),b.push({sUid:e,oFileInfo:i})):!0===v.oChunkQueue.isProcessed?v.oChunkQueue.aFiles.push({fStartUploadCallback:h,oFileInfo:i,sUid:e,fOnChunkEncryptCallback:a}):h(i,e,a):"personal"===t.sStorageType&&d.EnableInPersonalStorage?function(t,e,n,o,i){g||(setTimeout((function(){l.showPopup(f,[n,o,b.length,r.map(b,(function(t){return t.oFileInfo.FileName})),i])}),10),g=!0),b.push({sUid:t,oFileInfo:e})}(e,i,y,w,o.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_HTTPS_NEEDED")):(c.showError(o.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_HTTPS_NEEDED")),u(e)):s(e,i)})),s.subscribeEvent("CFilesView::FileDownloadCancel",(function(t){d.enableJscrypto()&&E()&&t.oFile.stopDownloading()})),s.subscribeEvent("CFilesView::FileUploadCancel",(function(t){d.enableJscrypto()&&E()?(v.oChunkQueue.aFiles.forEach((function(e,n,r){t.fOnUploadCancelCallback(e.sUid,e.oFileInfo.FileName)})),v.oChunkQueue.aFiles=[],v.stopUploading(t.sFileUploadUid,t.fOnUploadCancelCallback,t.sFileUploadName)):r.isFunction(t.fOnUploadCancelCallback)&&t.fOnUploadCancelCallback(t.sFileUploadUid,t.sFileUploadName)})),s.subscribeEvent("Jua::FileUploadingError",(function(){d.enableJscrypto()&&E()&&(v.oChunkQueue.isProcessed=!1,v.checkQueue())})),s.subscribeEvent("FilesWebclient::ParseFile::after",(function(t){var e=t[0],n=(null==e?void 0:e.oExtendedProps)||!1,r=(null==n?void 0:n.InitializationVector)||!1,o=!!r,i=(null==n?void 0:n.ParanoidKey)||!1,a=(null==n?void 0:n.ParanoidKeyShared)||!1,u=/\.(png|jpe?g|gif)$/.test(e.fileName().toLowerCase()),c=e.sOwnerName===s.getUserPublicId(),h=e.sharedWithMe();o&&(e.thumbnailSrc(""),(c||h)&&u&&d.enableJscrypto()?e.oActionsData.view.Handler=function(){v.viewEncryptedImage(e,r,h&&a?a:i)}:e.removeAction("view"),e.removeAction("list"),e.bIsSecure(!0),e.onSecureIconClick=function(t){l.showPopup(y,[e,r])})})),s.subscribeEvent("FileViewerWebclientPlugin::FilesCollection::after",(function(t){t.aFilesCollection(r.filter(t.aFilesCollection(),(function(t){return!(void 0!==t.oExtendedProps&&void 0!==t.oExtendedProps.InitializationVector)})))})),d.enableJscrypto.subscribe((function(t){null!==m&&m.requestStorages()})),s.subscribeEvent("FilesWebclient::ConstructView::after",(function(e){if("CFilesView"===e.Name){m=e.View;var n=t.run("MailWebclient","getComposeMessageWithAttachments");r.isFunction(n)&&(m.executeSend=function(){var t=this.selector.listCheckedAndSelected(),e=r.filter(t,(function(t){return t&&t.IS_FILE}),this),i=!1,s=r.map(e,(function(t){var e=!(!t.oExtendedProps||!t.oExtendedProps.InitializationVector);return i=i||e,{Storage:t.storageType(),Path:t.path(),Name:t.id()||t.fileName(),IsEncrypted:e}}));this.bAllowSendEmails&&e.length>0&&(i?l.showPopup(h,[o.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ALERT_SEND_ENCRYPTED_FILES"),function(t){t&&a.send("Files","SaveFilesAsTempFiles",{Files:s},(function(t){t.Result&&n(t.Result)}),this)}.bind(this)]):a.send("Files","SaveFilesAsTempFiles",{Files:s},(function(t){t.Result&&n(t.Result)}),this))},m.sendCommand=i.createCommand(m,m.executeSend,(function(){if(!this.isZipFolder()&&this.allSelectedFilesReady()){var t=this.selector.listCheckedAndSelected();return r.filter(t,(function(t){return t&&t.IS_FILE}),this).length>0}return!1})))}}));var e=n("0Oow");s.subscribeEvent("SharedFiles::UpdateShare::before",e.onBeforeUpdateShare),s.subscribeEvent("SharedFiles::OpenFilesSharePopup",(function(t){t.IsDir&&t.DialogHintText(o.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/INFO_SHARING_FOLDER"))}))}t.exports=function(t){return d.init(t),{start:function(t){v=n("/dxK"),t.run("OpenPgpWebclient","getOpenPgpEncryptor"),window.Blob&&window.URL&&r.isFunction(window.URL.createObjectURL)&&(u.chrome&&!E()?w(t):window.crypto&&window.crypto.subtle&&(u.edge||w(t)))},getConfirmEncryptionPopup:function(){return!!d.EnableInPersonalStorage&&p},isEnabled:function(){return d.enableJscrypto()&&E()}}}},"/ktp":(t,e,n)=>{"use strict";var r=n("a7T2"),o=n("p09A"),i=n("H20a"),a=n("o1lX");function s(){a.call(this),this.fEncrypt=null,this.fUpload=null,this.fCancel=null,this.message=o.observable(""),this.filesConfirmText=o.observable("")}r.extendOwn(s.prototype,a.prototype),s.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_ConfirmEncryptionPopup",s.prototype.onOpen=function(t,e,n,o,a){var s=r.map(a,(function(t){return i.encodeHtml(t)}));this.filesConfirmText(""),this.fEncrypt=t,this.fUpload=e,this.fCancel=n,this.message(i.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/CONFIRM_ENCRYPT_PLURAL",{VALUE:o>1?o:'"'+a[0]+'"'},null,o)),o>1&&this.filesConfirmText(s.join("<br />"))},s.prototype.cancelUpload=function(){this.fCancel(),this.closePopup()},s.prototype.encrypt=function(){this.fEncrypt(),this.closePopup()},s.prototype.upload=function(){this.fUpload(),this.closePopup()},t.exports=new s},"gE/T":(t,e,n)=>{"use strict";var r=n("a7T2"),o=n("p09A"),i=n("H20a"),a=n("o1lX");function s(){a.call(this),this.fUpload=null,this.fCancel=null,this.message=o.observable(""),this.filesConfirmText=o.observable(""),this.sErrorText=o.observable("")}r.extendOwn(s.prototype,a.prototype),s.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_ConfirmUploadPopup",s.prototype.onOpen=function(t,e,n,o,a){var s=r.map(o,(function(t){return i.encodeHtml(t)}));this.filesConfirmText(""),this.fUpload=t,this.fCancel=e,this.message(i.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/CONFIRM_UPLOAD_PLURAL",{VALUE:n>1?n:'"'+o[0]+'"'},null,n)),n>1&&this.filesConfirmText(s.join("<br />")),this.sErrorText(a)},s.prototype.cancelUpload=function(){this.fCancel(),this.closePopup()},s.prototype.upload=function(){this.fUpload(),this.closePopup()},t.exports=new s},"3ud5":(t,e,n)=>{"use strict";var r=n("a7T2"),o=n("p09A"),i=n("H20a"),a=n("o1lX"),s=n("oUN1"),u=n("XeMN");function c(){a.call(this),this.fExportKeyCallback=null,this.keyName=o.observable(""),this.fDelete=null,this.fDeleteCallback=null}r.extendOwn(c.prototype,a.prototype),c.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_DeleteKeyPopup",c.prototype.onOpen=function(t,e,n){r.isFunction(t)&&(this.fExportKeyCallback=r.bind((function(){this.closePopup(),t()}),this)),this.keyName(e),this.fDeleteCallback=r.bind((function(t){n.call(this,t),t?this.closePopup():this.showPopup()}),this)},c.prototype.deleteKey=function(){this.hidePopup(),s.showPopup(u,[i.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/CONFIRM_DELETE_KEY"),this.fDeleteCallback])},t.exports=new c},"7/WE":(t,e,n)=>{"use strict";var r=n("a7T2"),o=n("p09A"),i=n("o1lX");function a(){i.call(this),this.fExportKeyCallback=null,this.keyName=o.observable("")}r.extendOwn(a.prototype,i.prototype),a.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_ExportInformationPopup",a.prototype.onOpen=function(t,e){r.isFunction(t)&&(this.fExportKeyCallback=r.bind((function(){this.closePopup(),t()}),this)),this.keyName(e)},t.exports=new a},"mXd/":(t,e,n)=>{"use strict";var r=n("a7T2"),o=n("p09A"),i=n("9kOp"),a=n("o1lX"),s=n("0+zD");function u(){a.call(this),this.keyName=o.observable(i.getUserPublicId()),this.fOnGenerateCallback=null}r.extendOwn(u.prototype,a.prototype),u.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_GenerateKeyPopup",u.prototype.onOpen=function(t){this.fOnGenerateCallback=t},u.prototype.generateKey=function(){s.generateAndExportKey(r.bind((function(){this.fOnGenerateCallback()}),this),this.keyName()),this.closePopup()},t.exports=new u},PnO4:(t,e,n)=>{"use strict";var r=n("a7T2"),o=n("p09A"),i=n("o1lX"),a=n("H20a"),s=n("skxT");function u(){i.call(this),this.key=o.observable(""),this.fOnKeyEnterCallback=null,this.fOnCancellCallback=null}r.extendOwn(u.prototype,i.prototype),u.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_GetTemporaryKeyPopup",u.prototype.onOpen=function(t,e){this.key(""),this.fOnKeyEnterCallback=t,this.fOnCancellCallback=e},u.prototype.cancel=function(){this.fOnCancellCallback(),this.closePopup()},u.prototype.enterKey=function(){""===this.key()?s.showError(a.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_KEY_CANT_BE_BLANK")):(this.fOnKeyEnterCallback(this.key()),this.closePopup())},t.exports=new u},LAX2:(t,e,n)=>{"use strict";var r=n("a7T2"),o=n("p09A"),i=n("9kOp"),a=n("o1lX"),s=n("0+zD");function u(){a.call(this),this.keyName=o.observable(i.getUserPublicId()),this.newKey=o.observable("")}r.extendOwn(u.prototype,a.prototype),u.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_ImportKeyStringPopup",u.prototype.onOpen=function(){this.newKey("")},u.prototype.importKey=function(){s.importKeyFromString(this.keyName(),this.newKey()),this.closePopup()},t.exports=new u},mwH5:(t,e,n)=>{"use strict";function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function o(){o=function(){return e};var t,e={},n=Object.prototype,i=n.hasOwnProperty,a=Object.defineProperty||function(t,e,n){t[e]=n.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function h(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(t){h=function(t,e,n){return t[e]=n}}function p(t,e,n,r){var o=e&&e.prototype instanceof m?e:m,i=Object.create(o.prototype),s=new A(r||[]);return a(i,"_invoke",{value:I(t,n,s)}),i}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=p;var y="suspendedStart",d="suspendedYield",v="executing",b="completed",g={};function m(){}function E(){}function w(){}var C={};h(C,u,(function(){return this}));var P=Object.getPrototypeOf,k=P&&P(P(T([])));k&&k!==n&&i.call(k,u)&&(C=k);var N=w.prototype=m.prototype=Object.create(C);function O(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function n(o,a,s,u){var c=f(t[o],t,a);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==r(h)&&i.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,s,u)}),(function(t){n("throw",t,s,u)})):e.resolve(h).then((function(t){l.value=t,s(l)}),(function(t){return n("throw",t,s,u)}))}u(c.arg)}var o;a(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,o){n(t,r,e,o)}))}return o=o?o.then(i,i):i()}})}function I(e,n,r){var o=y;return function(i,a){if(o===v)throw Error("Generator is already running");if(o===b){if("throw"===i)throw a;return{value:t,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var u=L(s,r);if(u){if(u===g)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===y)throw o=b,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=v;var c=f(e,n,r);if("normal"===c.type){if(o=r.done?b:d,c.arg===g)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(o=b,r.method="throw",r.arg=c.arg)}}}function L(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,L(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var i=f(o,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function R(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function S(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(R,this),this.reset(!0)}function T(e){if(e||""===e){var n=e[u];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function n(){for(;++o<e.length;)if(i.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}throw new TypeError(r(e)+" is not iterable")}return E.prototype=w,a(N,"constructor",{value:w,configurable:!0}),a(w,"constructor",{value:E,configurable:!0}),E.displayName=h(w,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===E||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,h(t,l,"GeneratorFunction")),t.prototype=Object.create(N),t},e.awrap=function(t){return{__await:t}},O(x.prototype),h(x.prototype,c,(function(){return this})),e.AsyncIterator=x,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new x(p(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(N),h(N,l,"Generator"),h(N,u,(function(){return this})),h(N,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=T,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(S),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var u=i.call(a,"catchLoc"),c=i.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),S(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;S(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:T(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),g}},e}function i(t,e,n,r,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,o)}function a(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var a=t.apply(e,n);function s(t){i(a,r,o,s,u,"next",t)}function u(t){i(a,r,o,s,u,"throw",t)}s(void 0)}))}}var s=n("a7T2"),u=n("p09A"),c=n("H20a"),l=n("KC/L"),h=n("o1lX"),p=n("oUN1"),f=n("hT1I");function y(){h.call(this),this.fileName=u.observable(""),this.iv=u.observable(""),this.oldEncryptionMode=u.observable(!1),this.encryptedParanoidKey=""}s.extendOwn(y.prototype,h.prototype),y.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_InitializationVectorPopup",y.prototype.onOpen=function(t,e){this.oFile=t,this.fileName(t.fileName()),this.iv(e);var n=t&&t.oExtendedProps,r=n&&(t.sharedWithMe()?n.ParanoidKeyShared:n.ParanoidKey);this.encryptedParanoidKey=r,this.oldEncryptionMode(!r)},y.prototype.downloadEncrypted=function(){var t;s.isFunction(null===(t=this.oFile)||void 0===t?void 0:t.downloadFile)&&this.oFile.downloadFile(!0)},y.prototype.getAesKey=a(o().mark((function t(){var e,r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=n("/dxK"),t.next=3,e.decryptParanoidKey(this.encryptedParanoidKey);case 3:r=t.sent,l.isNonEmptyString(r)&&p.showPopup(f,[r,null,c.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/HEADING_IV_AES_KEY")]);case 5:case"end":return t.stop()}}),t,this)}))),t.exports=new y},A2fR:(t,e,n)=>{"use strict";var r=n("a7T2"),o=n("p09A"),i=n("EFhx"),a=n("AgXX"),s=n("H20a"),u=n("o1lX");function c(){u.call(this),this.message=o.observable(""),this.dontRemindMe=o.observable(!1),this.fContinueCallback=null,this.fCancelCallback=null}r.extendOwn(c.prototype,u.prototype),c.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_OutdatedEncryptionMethodPopup",c.prototype.onOpen=function(t,e,n){this.message(s.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/MESSAGE_OUTDATED_ENCRYPTION_METHOD",{FILENAME:t})),this.fContinueCallback=e,this.fCancelCallback=n},c.prototype.cancel=function(){this.fCancelCallback(),this.closePopup()},c.prototype.continueDownload=function(){this.dontRemindMe()&&i.send("CoreParanoidEncryptionWebclientPlugin","DontRemindMe",{},(function(t){!0===t.Result&&a.DontRemindMe(!0)}),this),this.fContinueCallback(),this.closePopup()},t.exports=new c},"0Oow":(t,e,n)=>{"use strict";function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function o(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return i(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){u=!0,a=t},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw a}}}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function a(){a=function(){return e};var t,e={},n=Object.prototype,o=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function h(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(t){h=function(t,e,n){return t[e]=n}}function p(t,e,n,r){var o=e&&e.prototype instanceof m?e:m,a=Object.create(o.prototype),s=new A(r||[]);return i(a,"_invoke",{value:I(t,n,s)}),a}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=p;var y="suspendedStart",d="suspendedYield",v="executing",b="completed",g={};function m(){}function E(){}function w(){}var C={};h(C,u,(function(){return this}));var P=Object.getPrototypeOf,k=P&&P(P(T([])));k&&k!==n&&o.call(k,u)&&(C=k);var N=w.prototype=m.prototype=Object.create(C);function O(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function n(i,a,s,u){var c=f(t[i],t,a);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==r(h)&&o.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,s,u)}),(function(t){n("throw",t,s,u)})):e.resolve(h).then((function(t){l.value=t,s(l)}),(function(t){return n("throw",t,s,u)}))}u(c.arg)}var a;i(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return a=a?a.then(o,o):o()}})}function I(e,n,r){var o=y;return function(i,a){if(o===v)throw Error("Generator is already running");if(o===b){if("throw"===i)throw a;return{value:t,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var u=L(s,r);if(u){if(u===g)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===y)throw o=b,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=v;var c=f(e,n,r);if("normal"===c.type){if(o=r.done?b:d,c.arg===g)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(o=b,r.method="throw",r.arg=c.arg)}}}function L(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,L(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var i=f(o,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function R(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function S(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(R,this),this.reset(!0)}function T(e){if(e||""===e){var n=e[u];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function n(){for(;++i<e.length;)if(o.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}throw new TypeError(r(e)+" is not iterable")}return E.prototype=w,i(N,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:E,configurable:!0}),E.displayName=h(w,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===E||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,h(t,l,"GeneratorFunction")),t.prototype=Object.create(N),t},e.awrap=function(t){return{__await:t}},O(x.prototype),h(x.prototype,c,(function(){return this})),e.AsyncIterator=x,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new x(p(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(N),h(N,l,"Generator"),h(N,u,(function(){return this})),h(N,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=T,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(S),!e)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var u=o.call(a,"catchLoc"),c=o.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),S(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;S(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:T(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),g}},e}function s(t,e,n,r,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,o)}function u(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){s(i,r,o,a,u,"next",t)}function u(t){s(i,r,o,a,u,"throw",t)}a(void 0)}))}}var c=n("a7T2"),l=n("H20a"),h=(n("KC/L"),n("EFhx"),n("TdEd")),p=n("skxT"),f=h.run("OpenPgpWebclient","getOpenPgpEncryptor"),y=n("/dxK");function d(t){return v.apply(this,arguments)}function v(){return(v=u(a().mark((function t(e){var n,r,o,i,s,u;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.map((function(t){return t.ContactUUID})).filter((function(t){return t})),r=e.map((function(t){return t.PublicId})),t.next=3,f.getPublicKeysByContactsAndEmails(n,r);case 3:return(o=t.sent).length<r.length&&(i=o.map((function(t){return t.getEmail()})),s=r.filter((function(t){return!i.includes(t)})),u=l.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_NO_PUBLIC_KEYS_FOR_USERS_PLURAL",{USERS:s.join(", ")},null,s.length),p.showError(u),o=!1),t.abrupt("return",o);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function b(t){return g.apply(this,arguments)}function g(){return(g=u(a().mark((function t(e){var n,r,o;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f.getCurrentUserPrivateKey();case 2:if(n=t.sent){t.next=5;break}return t.abrupt("return",!1);case 5:return t.next=7,f.askForKeyPassword(n.getUser());case 7:if(r=t.sent){t.next=10;break}return t.abrupt("return",!1);case 10:return t.next=12,y.decryptParanoidKey(e,r);case 12:return o=t.sent,t.abrupt("return",{decryptedParanoidKey:o,password:r});case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function m(){return(m=u(a().mark((function t(e){var n,r,i,s,u,l,h,p,f,v,g;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c.isFunction(e.OnSuccessCallback)&&c.isFunction(e.OnErrorCallback)){t.next=2;break}return t.abrupt("return");case 2:if(n=e.FileItem,r=n&&n.oExtendedProps,i=r&&(n.sharedWithMe()?r.ParanoidKeyShared:r.ParanoidKey),n&&n.IS_FILE&&i&&c.isArray(e.Shares)){t.next=6;break}return e.OnSuccessCallback(),t.abrupt("return");case 6:if(0!==(s=e.Shares.filter((function(t){return t.New}))).length){t.next=10;break}return e.OnSuccessCallback(),t.abrupt("return");case 10:return t.next=12,d(s);case 12:if(u=t.sent){t.next=16;break}return e.OnErrorCallback(),t.abrupt("return");case 16:return t.next=18,b(i);case 18:if(l=t.sent,h=l.decryptedParanoidKey,p=l.password,h){t.next=24;break}return e.OnErrorCallback(),t.abrupt("return");case 24:f=o(e.Shares),t.prev=25,g=a().mark((function t(){var e,n,r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=v.value,!(n=u.find((function(t){return t.emailParts.email===e.PublicId})))){t.next=8;break}return t.next=5,y.encryptParanoidKey(h,[n],p);case 5:(r=t.sent)&&(e.ParanoidKeyShared=r),delete e.New;case 8:case"end":return t.stop()}}),t)})),f.s();case 28:if((v=f.n()).done){t.next=32;break}return t.delegateYield(g(),"t0",30);case 30:t.next=28;break;case 32:t.next=37;break;case 34:t.prev=34,t.t1=t.catch(25),f.e(t.t1);case 37:return t.prev=37,f.f(),t.finish(37);case 40:e.OnSuccessCallback();case 41:case"end":return t.stop()}}),t,null,[[25,34,37,40]])})))).apply(this,arguments)}t.exports={onBeforeUpdateShare:function(t){return m.apply(this,arguments)}}},No2m:(t,e,n)=>{"use strict";function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function o(){o=function(){return e};var t,e={},n=Object.prototype,i=n.hasOwnProperty,a=Object.defineProperty||function(t,e,n){t[e]=n.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function h(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(t){h=function(t,e,n){return t[e]=n}}function p(t,e,n,r){var o=e&&e.prototype instanceof m?e:m,i=Object.create(o.prototype),s=new A(r||[]);return a(i,"_invoke",{value:I(t,n,s)}),i}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=p;var y="suspendedStart",d="suspendedYield",v="executing",b="completed",g={};function m(){}function E(){}function w(){}var C={};h(C,u,(function(){return this}));var P=Object.getPrototypeOf,k=P&&P(P(T([])));k&&k!==n&&i.call(k,u)&&(C=k);var N=w.prototype=m.prototype=Object.create(C);function O(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function n(o,a,s,u){var c=f(t[o],t,a);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==r(h)&&i.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,s,u)}),(function(t){n("throw",t,s,u)})):e.resolve(h).then((function(t){l.value=t,s(l)}),(function(t){return n("throw",t,s,u)}))}u(c.arg)}var o;a(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,o){n(t,r,e,o)}))}return o=o?o.then(i,i):i()}})}function I(e,n,r){var o=y;return function(i,a){if(o===v)throw Error("Generator is already running");if(o===b){if("throw"===i)throw a;return{value:t,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var u=L(s,r);if(u){if(u===g)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===y)throw o=b,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=v;var c=f(e,n,r);if("normal"===c.type){if(o=r.done?b:d,c.arg===g)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(o=b,r.method="throw",r.arg=c.arg)}}}function L(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,L(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var i=f(o,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function R(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function S(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(R,this),this.reset(!0)}function T(e){if(e||""===e){var n=e[u];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function n(){for(;++o<e.length;)if(i.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}throw new TypeError(r(e)+" is not iterable")}return E.prototype=w,a(N,"constructor",{value:w,configurable:!0}),a(w,"constructor",{value:E,configurable:!0}),E.displayName=h(w,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===E||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,h(t,l,"GeneratorFunction")),t.prototype=Object.create(N),t},e.awrap=function(t){return{__await:t}},O(x.prototype),h(x.prototype,c,(function(){return this})),e.AsyncIterator=x,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new x(p(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},O(N),h(N,l,"Generator"),h(N,u,(function(){return this})),h(N,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=T,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(S),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var u=i.call(a,"catchLoc"),c=i.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),S(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;S(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:T(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),g}},e}function i(t,e,n,r,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,o)}function a(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var a=t.apply(e,n);function s(t){i(a,r,o,s,u,"next",t)}function u(t){i(a,r,o,s,u,"throw",t)}s(void 0)}))}}var s=n("a7T2"),u=n("M4cL"),c=n("p09A"),l=n("H20a"),h=(n("KC/L"),n("TdEd")),p=n("skxT"),f=h.run("SettingsWebclient","getAbstractSettingsFormViewClass"),y=n("oUN1"),d=n("0+zD"),v=n("AgXX"),b=n("LAX2"),g=n("mXd/"),m=n("7/WE"),E=n("3ud5"),w=n("Zukw"),C=h.run("OpenPgpWebclient","getOpenPgpEncryptor");function P(){f.call(this,v.ServerModuleName),this.enableJscrypto=c.observable(v.enableJscrypto()),this.enableInPersonalStorage=c.observable(v.EnableInPersonalStorage),this.keyName=c.observable(""),this.bIsHttpsEnable="https:"===window.location.protocol,this.allowChangeSettings=c.observable(v.AllowChangeSettings),this.isImporting=c.observable(!1),this.exportKeyBound=s.bind(this.exportKey,this),this.isPGPKeysAvailable=c.observable(!0),c.isObservable(d.keyName)&&d.keyName.subscribe((function(){this.keyName(d.keyName())}),this),this.allowKeysManagement=c.observable(!!this.keyName()),this.keyName.subscribe((function(){this.keyName()&&this.allowKeysManagement(!0)}),this)}s.extendOwn(P.prototype,f.prototype),P.prototype.ViewTemplate="CoreParanoidEncryptionWebclientPlugin_ParanoidEncryptionSettingsFormView",P.prototype.enableBackwardCompatibility=function(){this.allowKeysManagement(!0)},P.prototype.importFileKey=function(){u("#import-key-file").click()},P.prototype.importStringKey=function(){y.showPopup(b)},P.prototype.readKeyFromFile=function(){var t,e=document.getElementById("import-key-file"),n=e.files[0],r=new FileReader,o="",i=e.files[0].name.split("."),a=s.bind((function(){this.isImporting(!1)}),this),u=s.bind((function(){this.isImporting(!1)}),this);if(i.splice(i.length-1,1),t=i.join(""),n){this.isImporting(!0),r.onload=function(e){o=e.target.result,d.importKeyFromString(t,o,a,u)};try{r.readAsText(n)}catch(t){p.showError(l.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_IMPORT_KEY"))}}else p.showError(l.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_IMPORT_KEY"))},P.prototype.generateNewKey=function(){y.showPopup(g,[s.bind((function(){y.showPopup(m,[this.exportKeyBound,this.keyName()])}),this)])},P.prototype.removeJscryptoKey=function(){var t=s.bind((function(t){t&&d.deleteKey().error&&p.showError(l.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_DELETE_KEY"))}),this);y.showPopup(E,[this.exportKeyBound,this.keyName(),t])},P.prototype.getCurrentValues=function(){return[this.enableJscrypto(),this.enableInPersonalStorage()]},P.prototype.revertGlobalValues=function(){this.enableJscrypto(v.enableJscrypto()),this.enableInPersonalStorage(v.EnableInPersonalStorage)},P.prototype.getParametersForSave=function(){return{EnableModule:this.enableJscrypto(),EnableInPersonalStorage:this.enableInPersonalStorage()}},P.prototype.applySavedValues=function(){v.update(this.enableJscrypto(),this.enableInPersonalStorage())},P.prototype.onShow=a(o().mark((function t(){var e;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return d.loadKeyNameFromStorage(),t.next=3,C.isPrivateKeyAvailable();case 3:e=t.sent,this.isPGPKeysAvailable(e),this.allowKeysManagement(!!this.keyName());case 6:case"end":return t.stop()}}),t,this)}))),P.prototype.exportKey=function(){var t=null,e=null,n=document.createElement("a");d.getKey(s.bind((function(r){r?d.exportKey().then(s.bind((function(r){t=new Blob([w.Array2HexString(new Uint8Array(r))],{type:"text/plain"}),e=window.URL.createObjectURL(t),document.body.appendChild(n),n.style="display: none",n.href=e,n.download=this.keyName(),n.click(),window.URL.revokeObjectURL(e)}),this)).catch((function(){p.showError(l.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY"))})):p.showError(l.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY"))}),this),!1,!1,!0)},t.exports=new P}}]);