"use strict";(self.webpackChunkafterlogic_aurora_platform=self.webpackChunkafterlogic_aurora_platform||[]).push([[5747],{"17yT":(t,e,i)=>{var o=i("a7T2"),s=i("M4cL"),n=i("p09A"),r=i("sdEb"),a=i("9kOp"),l=i("teN/"),h=i("H20a"),c=i("KC/L"),u=i("Tt1R"),p=i("REt5"),d=i("mGms"),m=["image/jpeg","image/jpg","image/png","image/gif","text/html","text/plain","text/css","text/rfc822-headers","message/delivery-status","application/x-httpd-php","application/javascript"],f=[];function b(){this.id=n.observable(""),this.index=n.observable(0),this.fileName=n.observable(""),this.tempName=n.observable(""),this.extension=n.observable(""),this.fileName.subscribe((function(t){this.id(t),this.extension(p.getFileExtension(t))}),this),this.displayName=n.computed((function(){return this.fileName()}),this),this.size=n.observable(0),this.friendlySize=n.computed((function(){return this.size()>0?h.getFriendlySize(this.size()):""}),this),this.hash=n.observable(""),this.thumbUrlInQueue=n.observable(""),this.thumbUrlInQueueSubscribtion=this.thumbUrlInQueue.subscribe((function(){this.getInThumbQueue()}),this),this.thumbnailSrc=n.observable(""),this.thumbnailLoaded=n.observable(!1),this.mimeType=n.observable(""),this.uploadUid=n.observable(""),this.uploaded=n.observable(!1),this.uploadError=n.observable(!1),this.downloading=n.observable(!1),this.bHasHtmlEmbed=!1,this.otherTemplates=n.observableArray([]),this.visibleCancelButton=n.observable(!0),this.cancelButtonTooltip=h.i18n("COREWEBCLIENT/ACTION_CANCEL"),this.statusText=n.observable(""),this.statusTooltip=n.computed((function(){return this.uploadError()?this.statusText():""}),this),this.progressPercent=n.observable(0),this.visibleProgress=n.observable(!1),this.uploadStarted=n.observable(!1),this.uploadStarted.subscribe((function(){this.uploadStarted()?(this.uploaded(!1),this.visibleProgress(!0),this.progressPercent(20)):(this.progressPercent(100),this.visibleProgress(!1),this.uploaded(!0))}),this),this.downloading.subscribe((function(){this.downloading()?this.visibleProgress(!0):(this.visibleProgress(!1),this.progressPercent(0))}),this),this.allowDrag=n.observable(!1),this.allowUpload=n.observable(!1),this.allowPublicLink=n.observable(!1),this.bIsSecure=n.observable(!1),this.sHeaderText="",this.oActionsData={view:{Text:h.i18n("COREWEBCLIENT/ACTION_VIEW_FILE"),HandlerName:"viewFile"},download:{Text:h.i18n("COREWEBCLIENT/ACTION_DOWNLOAD_FILE"),HandlerName:"downloadFile",Tooltip:n.computed((function(){var t=h.i18n("COREWEBCLIENT/INFO_CLICK_TO_DOWNLOAD_FILE",{FILENAME:this.fileName(),SIZE:this.friendlySize()});return""===this.friendlySize()&&(t=t.replace(" ()","")),t}),this)}},this.allowActions=n.observable(!0),this.iconAction=n.observable("download"),this.cssClasses=n.computed((function(){return this.getCommonClasses().join(" ")}),this),this.actions=n.observableArray([]),this.firstAction=n.computed((function(){return this.actions().length>1?this.actions()[0]:""}),this),this.secondAction=n.computed((function(){return 1===this.actions().length?this.actions()[0]:this.actions().length>1?this.actions()[1]:""}),this),this.subFiles=n.observableArray([]),this.subFilesExpanded=n.observable(!1),this.sUploadSubFolder="",this.bIsHidden=!1}s("html").hasClass("pdf")&&(m.push("application/pdf"),m.push("application/x-pdf")),b.prototype.addAction=function(t,e,i){e?this.actions.unshift(t):this.actions.push(t),this.actions(o.compact(this.actions())),i&&(this.oActionsData[t]=i)},b.prototype.removeAction=function(t){this.actions(o.without(this.actions(),t))},b.prototype.getMainAction=function(){return this.actions()[0]},b.prototype.hasAction=function(t){return-1!==o.indexOf(this.actions(),t)},b.prototype.getActionText=function(t){return this.hasAction(t)&&this.oActionsData[t]&&("string"==typeof this.oActionsData[t].Text||o.isFunction(this.oActionsData[t].Text))?o.isFunction(this.oActionsData[t].Text)?this.oActionsData[t].Text():this.oActionsData[t].Text:""},b.prototype.getActionUrl=function(t){return this.hasAction(t)&&this.oActionsData[t]&&this.oActionsData[t].Url||""},b.prototype.executeAction=function(t){var e=this.hasAction(t)&&this.oActionsData[t];e&&(o.isFunction(e.Handler)?e.Handler():"string"==typeof e.HandlerName&&o.isFunction(this[e.HandlerName])&&this[e.HandlerName]())},b.prototype.getTooltip=function(t){var e=this.hasAction(t)&&this.oActionsData[t]?this.oActionsData[t].Tooltip:"";return"string"==typeof e?e:o.isFunction(e)?e():""},b.prototype.getCommonClasses=function(){var t=[];return(this.allowUpload()&&!this.uploaded()||this.downloading())&&t.push("incomplete"),this.uploadError()?t.push("fail"):t.push("success"),t},b.prototype.parse=function(t){this.fileName(c.pString(t.FileName)),this.tempName(c.pString(t.TempName)),""===this.tempName()&&this.tempName(this.fileName()),this.mimeType(c.pString(t.MimeType)),this.size(t.EstimatedSize?c.pInt(t.EstimatedSize):c.pInt(t.SizeInBytes)),this.hash(c.pString(t.Hash)),this.parseActions(t),this.uploadUid(this.hash()),this.uploaded(!0),o.isFunction(this.additionalParse)&&this.additionalParse(t)},b.prototype.parseActions=function(t){this.thumbUrlInQueue(""!==c.pString(t.ThumbnailUrl)?c.pString(t.ThumbnailUrl)+"/"+Math.random():""),this.commonParseActions(t),this.commonExcludeActions()},b.prototype.commonExcludeActions=function(){this.isViewSupported()||this.removeAction("view")},b.prototype.commonParseActions=function(t){o.each(t.Actions,(function(t,e){this.oActionsData[e]||(this.oActionsData[e]={}),this.oActionsData[e].Url=c.pString(t.url),this.actions.push(e)}),this)},b.addViewExtensions=function(t){o.isArray(t)&&(f=o.union(f,t))},b.prototype.isViewSupported=function(){return-1!==s.inArray(this.mimeType(),m)||-1!==s.inArray(c.pString(this.extension()).toLowerCase(),f)},b.prototype.getInThumbQueue=function(){""===this.thumbUrlInQueue()||this.linked&&(!this.linked||this.linked())||l.thumbQueue(this.thumbUrlInQueue(),this.thumbnailSrc)},b.prototype.downloadFile=function(t){var e=this.getActionUrl("download"),i={File:this,CancelDownload:!1};e.length>0&&"#"!==e&&(t||a.broadcastEvent("AbstractFileModel::FileDownload::before",i),i.CancelDownload||(o.isFunction(i.CustomDownloadHandler)?i.CustomDownloadHandler():(e+="/"+r().unix(),u.downloadByUrl(e,"eml"===this.extension()))))},b.prototype.viewFile=function(t,e){p.calmEvent(e),this.viewCommonFile()},b.prototype.viewCommonFile=function(t){var e=null,i=null;c.isNonEmptyString(t)||(t=u.getAppPath()+this.getActionUrl("view")),t.length>0&&"#"!==t&&(i={sUrl:t+="/"+r().unix(),index:this.index(),hash:this.hash(),continueView:!0},a.broadcastEvent("AbstractFileModel::FileView::before",i),i.continueView&&(e=d.open(i.sUrl,i.sUrl,!1))&&e.focus())},b.prototype.eventDragStart=function(t,e){var i=e.originalEvent||e;return t&&i&&i.dataTransfer&&i.dataTransfer.setData&&i.dataTransfer.setData("DownloadURL",this.generateTransferDownloadUrl()),!0},b.prototype.generateTransferDownloadUrl=function(){var t=this.getActionUrl("download");return"http"!==t.substr(0,4)&&(t=u.getAppPath()+t),this.mimeType()+":"+this.fileName()+":"+t},b.prototype.onUploadSelect=function(t,e,i){i||(this.fileName(c.pString(e.FileName)),this.mimeType(c.pString(e.Type)),this.size(c.pInt(e.Size))),this.uploadUid(t),this.uploaded(!1),this.statusText(""),this.progressPercent(0),this.visibleProgress(!1),this.sUploadSubFolder=c.pString(e.Folder),this.bIsHidden=""!==this.sUploadSubFolder},b.prototype.onUploadStart=function(){this.visibleProgress(!0)},b.prototype.onUploadProgress=function(t,e){e>0&&(this.progressPercent(Math.ceil(t/e*100)),this.visibleProgress(!0))},b.prototype.onDownloadProgress=function(t,e){e>0&&(this.progressPercent(Math.ceil(t/e*100)),this.visibleProgress(this.progressPercent()<100))},b.prototype.onUploadComplete=function(t,e,i){var o=!(e&&i&&!i.ErrorCode&&i.Result&&!i.Result.Error),s=i&&i.ErrorCode&&i.ErrorCode===Enums.Errors.CanNotUploadFileLimit?h.i18n("COREWEBCLIENT/ERROR_UPLOAD_SIZE"):h.i18n("COREWEBCLIENT/ERROR_UPLOAD_UNKNOWN");this.progressPercent(0),this.visibleProgress(!1),this.uploaded(!0),this.uploadError(o),this.statusText(o?s:h.i18n("COREWEBCLIENT/REPORT_UPLOAD_COMPLETE")),o||(this.fillDataAfterUploadComplete(i,t),setTimeout(function(t){return function(){t.statusText("")}}(this),3e3))},b.prototype.fillDataAfterUploadComplete=function(t,e){},b.prototype.onImageLoad=function(t,e){""===this.thumbUrlInQueue()||this.thumbnailLoaded()||(this.thumbnailLoaded(!0),l.thumbQueue(this.thumbUrlInQueue()))},b.prototype.stopDownloading=function(){this.downloading(!1)},b.prototype.startDownloading=function(){this.downloading(!0)},t.exports=b},"teN/":(t,e,i)=>{var o,s,n=i("H20a"),r=i("oUN1"),a=i("hT1I"),l=i("OfVV"),h={getDownloadLink:function(t,e,i){return e.length>0?"?/Download/"+t+"/DownloadFile/"+e+"/"+(i?"0/"+i:""):""},getIframeWrappwer:function(t,e){return"?/Raw/Iframe/"+t+"/"+window.encodeURIComponent(e)+"/"}};h.thumbQueue=(o={},s={},function(t,e){e?!(t in s)||s[t]>0?(t in s||(s[t]=2,o[t]=[]),s[t]--,e(t)):o[t].push({imageSrc:t,imageSrcObserver:e}):o[t]&&o[t].length&&(o[t][0].imageSrcObserver(o[t][0].imageSrc),o[t].shift())}),h.showErrorIfAttachmentSizeLimit=function(t,e){var i=n.i18n("COREWEBCLIENT/ERROR_UPLOAD_SIZE_DETAILED",{FILENAME:t,MAXSIZE:n.getFriendlySize(l.AttachmentSizeLimit)});return l.AttachmentSizeLimit>0&&e>l.AttachmentSizeLimit&&(r.showPopup(a,[i]),!0)},t.exports=h},ypQf:(t,e,i)=>{t.exports=function(t){var e=i("a7T2"),o=i("M4cL"),s=i("H20a"),n=i("KC/L"),r=i("9kOp"),a=i("17yT"),l=i("2EIT");return r.isUserNormalOrTenant()?{start:function(h){var c=t.OfficeDocumentEditor?t.OfficeDocumentEditor.ExtensionsToView:[];c=c.map((t=>n.pString(t).toLowerCase())),a.addViewExtensions(c),r.subscribeEvent("FilesWebclient::ConstructView::after",(function(t){if("CFilesView"===t.Name){var o=t.View;if(o&&e.isFunction(o.registerCreateButtonsController)){var s=i("LP6e");o.registerCreateButtonsController(new s(o.storageType,o.currentPath))}}})),r.subscribeEvent("FilesWebclient::ParseFile::after",(function(t){var e=t[0],i=(t[1],n.pString(e.extension()).toLowerCase());e.hasAction("view")&&e.oActionsData.view&&-1!==o.inArray(i,c)&&(delete e.oActionsData.view.HandlerName,e.oActionsData.view.Handler=l.view.bind(e)),e.hasAction("convert")&&(e.removeAction("convert"),e.oActionsData.convert&&(e.actions.unshift("convert"),e.oActionsData.convert.Text=s.i18n("OFFICEDOCUMENTEDITOR/ACTION_EDIT_FILE"),e.oActionsData.convert.Handler=l.convert.bind(e)),e.hasAction("view")&&(e.removeAction("view"),e.actions.push("view"))),e.hasAction("edit")&&(e.removeAction("edit"),e.oActionsData.edit&&(e.actions.unshift("edit"),e.oActionsData.edit.Text=s.i18n("OFFICEDOCUMENTEDITOR/ACTION_EDIT_FILE"),e.oActionsData.edit.Handler=l.edit.bind(e)),e.hasAction("view")&&(e.removeAction("view"),e.actions.push("view")))}))}}:null}},qIqR:(t,e,i)=>{var o=i("a7T2"),s=i("p09A"),n=i("o1lX");function r(){n.call(this),this.convertInProgress=s.observable(!1),this.fConvertCallback=null,this.fViewCallback=null}o.extendOwn(r.prototype,n.prototype),r.prototype.PopupTemplate="OfficeDocumentEditor_ConvertPopup",r.prototype.onOpen=function(t,e){this.convertInProgress(!1),this.fConvertCallback=t,this.fViewCallback=e},r.prototype.convert=function(){o.isFunction(this.fConvertCallback)&&(this.convertInProgress(!0),this.fConvertCallback(this.closePopup.bind(this),this.convertInProgress))},r.prototype.view=function(){o.isFunction(this.fViewCallback)&&this.fViewCallback(),this.closePopup()},r.prototype.cancelPopup=function(){this.closePopup()},t.exports=new r},"0Foh":(t,e,i)=>{var o=i("a7T2"),s=i("p09A"),n=i("o1lX");function r(){n.call(this),this.fCallback=null,this.filename=s.observable(""),this.filename.focus=s.observable(!1),this.filename.error=s.observable(""),this.sExtension="",this.filename.subscribe((function(){this.filename.error("")}),this)}o.extendOwn(r.prototype,n.prototype),r.prototype.PopupTemplate="OfficeDocumentEditor_CreateDocumentPopup",r.prototype.onOpen=function(t,e,i){this.filename(t),this.filename.focus(!0),this.filename.error(""),this.sExtension=e,this.fCallback=i},r.prototype.create=function(){if(this.filename.error(""),o.isFunction(this.fCallback)){var t=this.fCallback(this.filename(),this.sExtension);t?this.filename.error(""+t):this.closePopup()}else this.closePopup()},t.exports=new r},"2EIT":(t,e,i)=>{var o=i("a7T2"),s=i("sdEb"),n=i("KC/L"),r=i("Tt1R"),a=i("EFhx"),l=i("/QeJ"),h=i("TdEd"),c=i("oUN1"),u=i("mGms"),p=h.run("FilesWebclient","getFileConstructor"),d=i("qIqR"),m={},f={},b=0,E={};function v(t,e){a.send("OfficeDocumentEditor","ConvertDocument",{Type:this.storageType(),Path:this.path(),FileName:this.fileName()},(function(i){if(o.isFunction(e)&&e(!1),i&&i.Result){var s=new p(i.Result);h.run("FilesWebclient","refresh"),s.executeAction("edit"),o.isFunction(t)&&t()}else l.showErrorByCode(i)}),this)}E.view=function(){var t=null,e=r.getAppPath()+this.getActionUrl("view")+"/"+s().unix();n.isNonEmptyString(e)&&"#"!==e&&(t=u.open(e,e,!1))&&t.focus()},E.edit=function(){if(m[this.fullPath()]&&!m[this.fullPath()].Win.closed)m[this.fullPath()].Win.focus();else{var t=null,e=this.getActionUrl("edit");n.isNonEmptyString(e)&&"#"!==e&&("convert"===e||(e=r.getAppPath()+e+"/"+s().unix(),(t=u.open(e,e,!1))&&(function(t,e){var i=t.fullPath();m[i]={Win:e,File:t},clearInterval(b),b=setInterval((function(){o.each(m,(function(t,e){t.Win.closed&&(f[e]=s(),delete m[e])})),o.isEmpty(m)&&clearInterval(b)}),500)}(this,t),t.focus())))}},E.convert=function(){c.showPopup(d,[v.bind(this),E.view.bind(this)])},t.exports=E},LP6e:(t,e,i)=>{var o=i("M4cL"),s=i("a7T2"),n=i("p09A"),r=i("REt5"),a=i("H20a"),l=i("EFhx"),h=i("/QeJ"),c=i("TdEd"),u=i("oUN1"),p=c.run("FilesWebclient","getFileConstructor"),d=i("0Foh");function m(t,e){this.storageType=s.isFunction(t)?t:n.observable(""),this.currentPath=s.isFunction(e)?e:n.observable(""),this.allowCreateItems=n.computed((function(){return this.storageType()!==Enums.FileStorageType.Encrypted&&this.storageType()!==Enums.FileStorageType.Shared}),this),this.createDocumentCommand=r.createCommand(this,this.createDocument,this.allowCreateItems),this.createSpreadSheetCommand=r.createCommand(this,this.createSpreadSheet,this.allowCreateItems),this.createPresentationCommand=r.createCommand(this,this.createPresentation,this.allowCreateItems)}m.prototype.ViewTemplate="OfficeDocumentEditor_AddFileButtonView",m.prototype.createDocument=function(){u.showPopup(d,[a.i18n("OFFICEDOCUMENTEDITOR/LABEL_BLANK_DOCUMENT_NAME"),"docx",this.createDocumentWithName.bind(this)])},m.prototype.createDocumentWithName=function(t,e){return t=o.trim(t),r.validateFileOrFolderName(t)?(l.send("OfficeDocumentEditor","CreateBlankDocument",{Type:this.storageType(),Path:this.currentPath(),FileName:t+"."+e},this.onCreateBlankDocumentResponse,this),""):a.i18n("FILESWEBCLIENT/ERROR_INVALID_FILE_NAME")},m.prototype.onCreateBlankDocumentResponse=function(t){if(t&&t.Result){var e=new p(t.Result);e.path()===this.currentPath()&&e.storageType()===this.storageType()&&c.run("FilesWebclient","addFileToCurrentFolder",[e]),c.run("FilesWebclient","refresh"),e.executeAction("edit")}else h.showErrorByCode(t)},m.prototype.createSpreadSheet=function(){u.showPopup(d,[a.i18n("OFFICEDOCUMENTEDITOR/LABEL_BLANK_SPREADSHEET_NAME"),"xlsx",this.createDocumentWithName.bind(this)])},m.prototype.createPresentation=function(){u.showPopup(d,[a.i18n("OFFICEDOCUMENTEDITOR/LABEL_BLANK_PRESENTATION_NAME"),"pptx",this.createDocumentWithName.bind(this)])},t.exports=m}}]);