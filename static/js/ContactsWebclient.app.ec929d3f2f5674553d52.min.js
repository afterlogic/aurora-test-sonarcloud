(self.webpackChunkafterlogic_aurora_platform=self.webpackChunkafterlogic_aurora_platform||[]).push([[6335],{Cjfl:(e,t,s)=>{"use strict";var o=s("a7T2"),a=s("M4cL"),i=s("p09A"),n=s("rhHV"),r=s("TdEd"),l=s("skxT"),c=r.run("MailWebclient","getComposeMessageToAddresses"),d=r.run("MailWebclient","getSearchMessagesInCurrentFolder"),u=s("oUN1"),p=s("muMM"),h=s("hW2p"),m={contacts:i.observableArray([]),ViewTemplate:"ContactsWebclient_ContactCardsView",bAllowComposeMessageToAddresses:o.isFunction(c),searchMessagesInCurrentFolder:d||function(){},bAllowSearchMessagesInCurrentFolder:o.isFunction(d),add:function(e){var t=o.filter(this.contacts(),(function(t){return-1===a.inArray(t.email(),o.keys(e))}));this.contacts(t.concat(o.compact(o.values(e))))}};function C(e,t){var s=a("div.item_viewer[data-email='"+t+"']"),o=!1,i=0,n=function(){s&&e&&(o=!0,clearTimeout(i),setTimeout((function(){var t,i,n,r=e.offset();o&&r.left+r.top!==0&&(t=r.left+10,i=r.top+e.height()+6,(n=a(window).width()-(t+396))>0&&(n=0),s.addClass("expand").offset({top:i,left:t+n}))}),180))},r=function(){o&&s&&e&&(o=!1,i=setTimeout((function(){o||s.removeClass("expand")}),200))};s.length>0?(e.off().on("mouseover",(function(){s.off().on("mouseenter",n).on("mouseleave",r).find(".link, .button").off(".links").on("click.links",(function(){o=!1,s.removeClass("expand")})),setTimeout(function(){s.find(".link, .button").off("click.links").on("click.links",(function(){o=!1,s.removeClass("expand")}))}.bind(this),100),n()})).on("mouseout",r),o=!1,s.removeClass("expand")):e.off()}function f(e){e.next().hasClass("add_contact")&&e.next().remove(),e.removeClass("found"),e.parent().removeClass("found_contact"),e.off()}function b(e,t){o.each(e,(function(s){var i=s.attr("data-email"),r=t[i];if(void 0!==r)if(f(s),null===r){var l=a('<span class="add_contact"></span>');s.after(l),n.init(l,"CONTACTSWEBCLIENT/ACTION_ADD_TO_CONTACTS"),l.on("click",(function(){u.showPopup(p,[s.attr("data-name"),i,function(t){o.each(e,(function(e){e.attr("data-email")===i&&(f(e),e.addClass("found"),e.parent().addClass("found_contact"),m.add(t),C(e,i))}))}])}))}else s.addClass("found"),s.parent().addClass("found_contact"),m.add(t),C(s,i)}))}l.showAnyView(m),e.exports={applyTo:function(e){var t=o.map(e,(function(e){return a(e)})),s=o.uniq(o.map(t,(function(e){return e&&e.attr("data-email")}))).slice(0,100);h.getContactsByEmails(s,o.bind(b,{},t))}}},lDT7:(e,t,s)=>{"use strict";var o=s("hW2p"),a={markVcardsExistentByFile:function(e){o.markVcardsExistentByFile(e)},updateVcardUid:function(e,t){o.updateVcardUid(e,t)}};window.MainTabContactsMethods=a,e.exports={}},Rq3T:(e,t,s)=>{"use strict";var o=s("a7T2"),a=s("M4cL"),i=(s("kG5I"),s("KC/L"),s("xGhG"));e.exports={callback:function(e,t,{storage:s="all",addContactGroups:n=!1,addUserGroups:r=!1,exceptEmail:l="",addEmailsToGroups:c=!1,useEmailAsValues:d=!1}){var u={Search:e.term,Storage:s,SortField:Enums.ContactSortField.Frequency,SortOrder:1,WithGroups:n,WithUserGroups:r,WithoutTeamContactsDuplicates:!0};i.send("GetContactSuggestions",u,(function(e){var s=[];e&&e.Result&&e.Result.List&&(s=(s=o.map(e.Result.List,(function(e){if(e.IsGroup&&e.Name)return e.Emails?{label:c?`${e.Name} (${e.Emails})`:e.Name,value:c?e.Emails:e.Name,name:e.Name,email:c?e.Emails:e.Name,groupId:e.Id,isUserGroup:!0,isAllUsersGroup:e.IsAll}:null;var t=e.ViewEmail,s="";return!d&&e.FullName&&0<a.trim(e.FullName).length&&(e.ForSharedToAll?t=e.FullName:e.IsGroup?(s=`${e.FullName} (${e.ViewEmail})`,t=e.ViewEmail):t='"'+e.FullName+'" <'+e.ViewEmail+">"),e&&e.ViewEmail&&e.ViewEmail!==l?{label:s||t,value:t,name:e.FullName,email:e.ViewEmail,frequency:e.Frequency,id:e.UUID,storage:e.Storage,uuid:e.UUID,team:"team"===e.Storage,sharedToAll:"shared"===e.Storage,hasKey:e.HasPgpPublicKey,encryptMessage:e.PgpEncryptMessages,signMessage:e.PgpSignMessages,isContactGroup:e.IsGroup}:null}))).filter((e=>e&&e.email)),s=o.sortBy(o.compact(s),(function(e){return-e.frequency}))),t(s)}))},deleteHandler:function(e){i.send("UpdateContact",{Contact:{UUID:e.id,Frequency:-1,Storage:e.storage}})}}},"8qea":(e,t,s)=>{"use strict";var o=s("a7T2"),a=s("KC/L");void 0===window.Enums&&(window.Enums={}),o.extendOwn(window.Enums,{SharedAddressbookAccess:{NoAccess:0,Write:1,Read:2}}),e.exports={init(e,t){const s=e[t];window.Enums.ContactsPrimaryEmail=a.pObject(s&&s.PrimaryEmail),window.Enums.ContactsPrimaryPhone=a.pObject(s&&s.PrimaryPhone),window.Enums.ContactsPrimaryAddress=a.pObject(s&&s.PrimaryAddress),window.Enums.ContactSortField=a.pObject(s&&s.SortField)}}},xGtF:(e,t,s)=>{"use strict";e.exports=function(e){var t=s("a7T2"),o=s("H20a"),a=s("9kOp"),i=s("TdEd"),n=s("hW2p"),r=s("8qea"),l=s("Y40+"),c=s("rHGs"),d=s("Rq3T"),u={getSuggestionsAutocompleteCallback:function(e){var t=function(t,s){d.callback(t,s,e)};return i.run("OpenPgpWebclient","getSuggestionsAutocompleteFilteredCallback",[t])||t},getSuggestionsAutocompleteDeleteHandler:function(){return d.deleteHandler},getContactsByEmails:function(e,t){n.getContactsByEmails(e,t)}},p=function(){a.subscribeEvent("MailWebclient::RegisterMessagePaneController",(function(e){e(s("MYHY"),"BeforeMessageBody")}))},h={applyContactsCards:function(e){s("Cjfl").applyTo(e)}};return r.init(e,l.ServerModuleName),l.init(e),i.isModuleAvailable(l.ServerModuleName)&&a.isUserNormalOrTenant()?a.isMobile()?t.extend({start:p,getSettings:function(){return l},getHeaderItemView:function(){return s("zXiY")}},u):a.isNewTab()?t.extend({start:p},u,h):(s("lDT7"),t.extend({start:function(e){e.run("SettingsWebclient","registerSettingsTab",[function(){return s("Ub4N")},l.HashModuleName,o.i18n("CONTACTSWEBCLIENT/LABEL_SETTINGS_TAB")]),l.AllowAddressBooksManagement&&e.run("SettingsWebclient","registerSettingsTab",[function(){return s("h9EH")},"manage-addressbooks",o.i18n("CONTACTSWEBCLIENT/LABEL_MANAGE_ADDRESSBOOK_SETTINGS_TAB")]),p()},getScreens:function(){var e={};return e[l.HashModuleName]=function(){return new(s("iiou"))},e},getHeaderItem:function(){return{item:s("zXiY"),name:l.HashModuleName}},isTeamContactsAllowed:function(){return c.checkStorageExists("team")},getMobileSyncSettingsView:function(){return s("gBUy")}},u,h)):null}},CUTT:(e,t,s)=>{"use strict";var o=s("a7T2"),a=s("p09A"),i=s("H20a"),n=s("KC/L"),r=s("/QeJ"),l=s("9kOp"),c=s("xGhG"),d=s("hW2p"),u=l.isNewTab()?null:s("zXiY"),p=l.isNewTab()&&window.opener?window.opener.MainTabContactsMethods:null;function h(){this.uid=a.observable(""),this.file=a.observable(""),this.name=a.observable(""),this.email=a.observable(""),this.exists=a.observable(!1),this.isJustSaved=a.observable(!1)}h.prototype.parse=function(e){e&&"Object/Aurora\\Modules\\Mail\\Classes\\Vcard"===e["@Object"]&&(this.uid(n.pString(e.Uid)),this.file(n.pString(e.File)),this.name(n.pString(e.Name)),this.email(n.pString(e.Email)),this.exists(!!e.Exists),d.addVcard(this))},h.prototype.onContactsSaveVcfResponse=function(e,t){e.Result?o.isArray(e.Result.ImportedUids)&&1===e.Result.ImportedUids.length&&(this.uid(e.Result.ImportedUids[0]),p&&p.updateVcardUid(this.file(),this.uid())):(r.showErrorByCode(e,i.i18n("CONTACTSWEBCLIENT/ERROR_CREATE_CONTACT")),this.exists(!1))},h.prototype.addContact=function(){c.send("AddContactsFromFile",{File:this.file()},this.onContactsSaveVcfResponse,this),this.isJustSaved(!0),this.exists(!0),setTimeout(o.bind((function(){this.isJustSaved(!1)}),this),2e4),u?u.recivedAnim(!0):p&&p.markVcardsExistentByFile(this.file())},e.exports=h},muMM:(e,t,s)=>{"use strict";var o=s("a7T2"),a=s("p09A"),i=s("H20a"),n=s("/QeJ"),r=s("W66n"),l=s("skxT"),c=s("o1lX"),d=s("rHGs"),u=s("xGhG"),p=s("hW2p"),h=s("zXiY");function m(){c.call(this),this.displayName=a.observable(""),this.email=a.observable(""),this.phone=a.observable(""),this.address=a.observable(""),this.skype=a.observable(""),this.facebook=a.observable(""),this.focusDisplayName=a.observable(!1),this.loading=a.observable(!1),this.fCallback=function(){}}o.extendOwn(m.prototype,c.prototype),m.prototype.PopupTemplate="ContactsWebclient_CreateContactPopup",m.prototype.onOpen=function(e,t,s){this.displayName()===e&&this.email()===t||(this.displayName(e),this.email(t),this.phone(""),this.address(""),this.skype(""),this.facebook("")),this.fCallback=o.isFunction(s)?s:function(){}},m.prototype.onSaveClick=function(){if(this.canBeSave()){if(!this.loading()){var e={PrimaryEmail:Enums.ContactsPrimaryEmail.Personal,FullName:this.displayName(),PersonalEmail:this.email(),PersonalPhone:this.phone(),PersonalAddress:this.address(),Skype:this.skype(),Facebook:this.facebook(),Storage:"personal"};this.loading(!0),u.send("CreateContact",{Contact:e},this.onCreateContactResponse,this)}}else l.showError(i.i18n("CONTACTSWEBCLIENT/ERROR_EMAIL_OR_NAME_BLANK"))},m.prototype.cancelPopup=function(){this.loading(!1),this.closePopup()},m.prototype.onCreateContactResponse=function(e,t){var s=t.Parameters;this.loading(!1),e.Result?(l.showReport(i.i18n("CONTACTSWEBCLIENT/REPORT_CONTACT_SUCCESSFULLY_ADDED")),p.clearInfoAboutEmail(s.Contact.PersonalEmail),p.getContactsByEmails([s.Contact.PersonalEmail],this.fCallback),this.closePopup(),h.isCurrent()||h.recivedAnim(!0)):n.showErrorByCode(e,i.i18n("CONTACTSWEBCLIENT/ERROR_CREATE_CONTACT"))},m.prototype.canBeSave=function(){return""!==this.displayName()||""!==this.email()},m.prototype.goToContacts=function(){p.saveNewContactParams({displayName:this.displayName(),email:this.email(),phone:this.phone(),address:this.address(),skype:this.skype(),facebook:this.facebook()}),this.closePopup(),r.replaceHash(d.getContacts("personal","","",1,"","create-contact"))},e.exports=new m},QgF7:(e,t,s)=>{"use strict";var o=s("a7T2"),a=s("p09A"),i=s("H20a"),n=s("EFhx"),r=s("/QeJ"),l=s("o1lX"),c=s("skxT");function d(){l.call(this),this.createMode=a.observable(!1),this.saving=a.observable(!1),this.addressBookName=a.observable(""),this.addressBookNameFocus=a.observable(!1),this.fCallback=null}o.extendOwn(d.prototype,l.prototype),d.prototype.PopupTemplate="ContactsWebclient_EditAddressBookPopup",d.prototype.onOpen=function(e,t,s){this.fCallback=e,this.iEntityId=t,this.createMode(!this.iEntityId),this.addressBookName(s||""),this.addressBookNameFocus(!0)},d.prototype.save=function(){if(o.isEmpty(this.addressBookName()))return c.showError(i.i18n("CONTACTSWEBCLIENT/ERROR_ADDRESSBOOK_NAME_EMPTY")),void this.addressBookNameFocus(!0);var e=this.createMode()?"CreateAddressBook":"UpdateAddressBook",t={AddressBookName:this.addressBookName()};this.createMode()||(t.EntityId=this.iEntityId),this.addressBookNameFocus(!1),this.saving(!0),n.send("Contacts",e,t,this.onSaveAddressBookResponse,this)},d.prototype.onSaveAddressBookResponse=function(e,t){if(this.saving(!1),e&&e.Result){var s=this.createMode()?i.i18n("CONTACTSWEBCLIENT/REPORT_CREATE_ADDRESSBOOK"):i.i18n("CONTACTSWEBCLIENT/REPORT_UPDATE_ADDRESSBOOK");c.showReport(s),o.isFunction(this.fCallback)&&this.fCallback(),this.closePopup()}else{var a=this.createMode()?i.i18n("CONTACTSWEBCLIENT/ERROR_CREATE_ADDRESSBOOK"):i.i18n("CONTACTSWEBCLIENT/ERROR_UPDATE_ADDRESSBOOK");r.showErrorByCode(e,a)}},d.prototype.cancelPopup=function(){this.saving()||this.closePopup()},e.exports=new d},h9EH:(e,t,s)=>{"use strict";var o=s("a7T2"),a=s("p09A"),i=s("H20a"),n=s("EFhx"),r=s("/QeJ"),l=s("9kOp"),c=s("XeMN"),d=s("oUN1"),u=s("TdEd").run("SettingsWebclient","getAbstractSettingsFormViewClass"),p=s("QgF7");function h(){u.call(this),this.addressBooks=a.observableArray([]),this.loading=a.observable(!1)}o.extendOwn(h.prototype,u.prototype),h.prototype.ViewTemplate="ContactsWebclient_AddressBooksSettingsFormView",h.prototype.onShow=function(){this.populate()},h.prototype.populate=function(){this.loading(!0),n.send("Contacts","GetStorages",{},(function(e){if(this.loading(!1),o.isArray(e&&e.Result)){const t=l.getUserPublicId();this.addressBooks(e.Result.filter((e=>e?.Display&&e?.Owner===t&&"personal"!==e.Id)))}else r.showErrorByCode(e)}),this)},h.prototype.addAddressBook=function(){d.showPopup(p,[this.populate.bind(this)])},h.prototype.editAddressBook=function(e,t){d.showPopup(p,[this.populate.bind(this),e,t])},h.prototype.deleteAddressBook=function(e,t){var s=i.i18n("CONTACTSWEBCLIENT/CONFIRM_DELETE_ADDRESSBOOK",{NAME:t}),a=o.bind((function(t){t&&n.send("Contacts","DeleteAddressBook",{EntityId:e},(function(e){e&&e.Result||r.showErrorByCode(e),this.populate()}),this)}),this);d.showPopup(c,[s,a])},e.exports=new h},Ub4N:(e,t,s)=>{"use strict";var o=s("a7T2"),a=s("p09A"),i=s("KC/L"),n=s("TdEd").run("SettingsWebclient","getAbstractSettingsFormViewClass"),r=s("Y40+");function l(){n.call(this,r.ServerModuleName),this.contactsPerPageValues=a.observableArray(i.getAdaptedPerPageList(r.ContactsPerPage)),this.contactsPerPage=a.observable(r.ContactsPerPage)}o.extendOwn(l.prototype,n.prototype),l.prototype.ViewTemplate="ContactsWebclient_ContactsSettingsFormView",l.prototype.getCurrentValues=function(){return[this.contactsPerPage()]},l.prototype.revertTeamValues=function(){this.contactsPerPage(r.ContactsPerPage)},l.prototype.getParametersForSave=function(){return{ContactsPerPage:this.contactsPerPage()}},l.prototype.applySavedValues=function(e){r.update(e.ContactsPerPage)},e.exports=new l},zXiY:(e,t,s)=>{"use strict";var o=s("H20a"),a=s("C5H3");e.exports=new a(o.i18n("CONTACTSWEBCLIENT/ACTION_SHOW_CONTACTS"))},gBUy:(e,t,s)=>{"use strict";var o=s("p09A");function a(){this.AddressBooks=o.observableArray([])}s("Y40+"),a.prototype.ViewTemplate="ContactsWebclient_MobileSyncSettingsView",a.prototype.populate=function(e){if(Array.isArray(e.Contacts)){const t=e.Contacts.map((e=>({DisplayName:e.Name,DavUrl:e.Url})));this.AddressBooks(t)}},e.exports=new a},MYHY:(e,t,s)=>{"use strict";var o=s("a7T2"),a=s("p09A"),i=s("KC/L"),n=s("hW2p"),r=s("CUTT");function l(){this.vcard=a.observable(null)}l.prototype.ViewTemplate="ContactsWebclient_VcardAttachmentView",l.prototype.doAfterPopulatingMessage=function(e){var t=e&&i.isNonEmptyArray(e.aExtend)?e.aExtend:[],s=o.find(t,(function(e){return"Object/Aurora\\Modules\\Mail\\Classes\\Vcard"===e["@Object"]}));if(s){var a=n.getVcard(s.File);a||(a=new r).parse(s),this.vcard(a)}else this.vcard(null)},e.exports=new l},C5H3:(e,t,s)=>{var o=s("p09A"),a=s("W66n");function i(e){this.sName="",this.visible=o.observable(!0),this.baseHash=o.observable(""),this.hash=o.observable(""),this.linkText=o.observable(e),this.isCurrent=o.observable(!1),this.recivedAnim=o.observable(!1).extend({autoResetToFalse:500}),this.unseenCount=o.observable(0),this.allowChangeTitle=o.observable(!1),this.inactiveTitle=o.observable(""),this.excludedHashes=o.observableArray([])}i.prototype.ViewTemplate="CoreWebclient_HeaderItemView",i.prototype.setName=function(e){this.sName=e.toLowerCase(),""===this.baseHash()?(this.hash(a.buildHashFromArray([e.toLowerCase()])),this.baseHash(this.hash())):this.hash(this.baseHash())},e.exports=i}}]);