"use strict";(self.webpackChunkafterlogic_aurora_platform=self.webpackChunkafterlogic_aurora_platform||[]).push([[6903],{A3in:(e,t,s)=>{var o=s("a7T2"),i=s("sdEb"),n={getTimeListStepHour:function(e,t){return e=e||"HH:mm",t=t||"k",o.map(["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],(function(s){var o=i(s,"HH:mm");return{text:o.format(e),value:o.format(t)}}))},getTimeListStepHalfHour:function(e){return o.map(["00:00","00:30","01:00","01:30","02:00","02:30","03:00","03:30","04:00","04:30","05:00","05:30","06:00","06:30","07:00","07:30","08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00","18:30","19:00","19:30","20:00","20:30","21:00","21:30","22:00","22:30","23:00","23:30"],(function(t){var s=i(t,"HH:mm").format(e);return{text:s,value:s}}))},getDateFormatForDatePicker:function(e){return e.replace("MM","mm").replace("DD","dd").replace("YYYY","yy").replace("Month","MM")}};e.exports=n},injE:(e,t,s)=>{var o=s("H20a"),i={getMonthNamesArray:function(){for(var e=o.i18n("COREWEBCLIENT/LIST_MONTH_NAMES").split(" "),t=e.length;t<12;t++)e[t]="";return e},daysInMonth:function(e,t){return 0<e&&13>e&&0<t?new Date(t,e,0).getDate():31}};e.exports=i},vjMU:(e,t,s)=>{var o=s("a7T2"),i=s("KC/L");e.exports={ScheduledFolderName:"",PredefinedSchedule:[],CurrentScheduledFolderName:"",init:function(e){var t=e.MailScheduledMessages;o.isEmpty(t)||(this.ScheduledFolderName=i.pString(t.ScheduledFolderName,this.ScheduledFolderName),this.PredefinedSchedule=i.pArray(t.PredefinedSchedule,this.PredefinedSchedule))},setCurrentScheduledFolder:function(e){this.CurrentScheduledFolderName=e}}},ChcL:(e,t,s)=>{e.exports=function(e){var t=s("p09A"),o=s("H20a"),i=s("9kOp"),n=s("vjMU");s("okSt"),n.init(e);var a=n.ScheduledFolderName,r=n.ScheduledFolderName;function l(e){var s=e().sNamespaceFolder,i=e().sDelimiter;r=""!==s?s+i+a:a;var l=e().getFolderByFullName(r);l?(n.setCurrentScheduledFolder(r),l.displayName=t.observable(o.i18n("MAILSCHEDULEDMESSAGES/LABEL_FOLDER_SCHEDULED")),l.usedAs=t.observable(o.i18n("MAILSCHEDULEDMESSAGES/LABEL_USED_AS_SCHEDULED")),l.setDisableMoveTo(!0),l.setDisableMoveFrom(!0),l.setShowTotalInsteadUnseenCount(!0)):n.setCurrentScheduledFolder("")}return i.isUserNormalOrTenant()?{start:function(e){e.isModuleEnabled("MailWebclient")&&(e.run("MailWebclient","registerComposeToolbarController",[s("6Z3g")]),i.subscribeEvent("MailWebclient::ConstructView::before",(function(e){if("CMailView"===e.Name){var s=e.MailCache.folderList,o=t.computed((function(){return e.MailCache.folderList().currentFolder()}));l(s),s.subscribe((function(){l(s)})),o.subscribe((function(){(o()?o().fullName():"")===r?e.View.resetDisabledTools("MailScheduledMessages",["spam","move"]):e.View.resetDisabledTools("MailScheduledMessages",[])}))}})),i.subscribeEvent("MailWebclient::RegisterMessagePaneController",(function(e){e(s("Wmfn"),"BeforeMessageBody")})))}}:null}},"0I4a":(e,t,s)=>{var o=s("a7T2"),i=s("o1lX");function n(){i.call(this),this.fConfirmCallback=null,this.shown=!1}o.extendOwn(n.prototype,i.prototype),n.prototype.PopupTemplate="MailScheduledMessages_ConfirmAnotherMessageComposedPopup",n.prototype.onOpen=function(e){this.fConfirmCallback=o.isFunction(e)?e:null,this.shown=!0},n.prototype.onClose=function(){this.shown=!1},n.prototype.onDiscardClick=function(){this.shown&&this.fConfirmCallback&&this.fConfirmCallback(Enums.AnotherMessageComposedAnswer.Discard),this.closePopup()},n.prototype.onSaveAsDraftClick=function(){this.shown&&this.fConfirmCallback&&this.fConfirmCallback(Enums.AnotherMessageComposedAnswer.SaveAsDraft),this.closePopup()},n.prototype.cancelPopup=function(){this.fConfirmCallback&&this.fConfirmCallback(Enums.AnotherMessageComposedAnswer.Cancel),this.closePopup()},n.prototype.onEnterHandler=function(){this.onSaveAsDraftClick()},e.exports=new n},VANH:(e,t,s)=>{var o=s("M4cL"),i=s("a7T2"),n=s("p09A"),a=s("sdEb"),r=s("A3in"),l=s("injE"),d=s("H20a"),h=s("REt5"),u=s("EFhx"),c=s("/QeJ"),m=s("o1lX"),p=s("TdEd"),E=s("skxT"),S=s("OfVV"),f=s("MYnu"),A=s("vjMU");function M(){m.call(this),this.oCompose=null,this.fOnClose=null,this.aOptions=f.getPredefinedOptions(),this.scheduledTime=n.observable(0),this.timeFormatMoment="HH:mm",this.dateFormatMoment="MM/DD/YYYY",this.dateFormatDatePicker="mm/dd/yy",this.dateDom=n.observable(null),this.timeOptions=n.observableArray(r.getTimeListStepHalfHour(S.timeFormat()!==Enums.TimeFormat.F24?"hh:mm A":"HH:mm")),S.timeFormat.subscribe((function(){this.timeOptions(r.getTimeListStepHalfHour(S.timeFormat()!==Enums.TimeFormat.F24?"hh:mm A":"HH:mm"))}),this),this.selectedDate=n.observable(""),this.selectedTime=n.observable(""),this.selectedTime.subscribe((function(){""!==this.selectedTime()&&this.selectDatetime()}),this),this.lockSelectStartEndDate=n.observable(!1),this.initializeDatePickers(),this.scheduleInProcess=n.observable(!1),this.scheduleCommand=h.createCommand(this,this.schedule,function(){return 0!==this.scheduledTime()&&!this.scheduleInProcess()}.bind(this))}i.extendOwn(M.prototype,m.prototype),M.prototype.PopupTemplate="MailScheduledMessages_ScheduleSendingPopup",M.prototype.onOpen=function(e,t){this.oCompose=e,this.fOnClose=t,this.timeFormatMoment=S.timeFormat()===Enums.TimeFormat.F24?"HH:mm":"hh:mm A",this.dateFormatMoment=h.getDateFormatForMoment(S.dateFormat()),this.dateFormatDatePicker=r.getDateFormatForDatePicker(S.dateFormat()),this.selectedDate(""),this.selectedTime(""),this.scheduledTime(0),this.initializeDatePickers()},M.prototype.initializeDatePickers=function(){this.dateDom()&&(this.createDatePickerObject(this.dateDom(),this.selectDatetime.bind(this)),this.dateDom().datepicker("option","dateFormat",this.dateFormatDatePicker))},M.prototype.createDatePickerObject=function(e,t){o(e).datepicker({showOtherMonths:!0,selectOtherMonths:!0,monthNames:l.getMonthNamesArray(),dayNamesMin:d.i18n("COREWEBCLIENT/LIST_DAY_NAMES_MIN").split(" "),nextText:"",prevText:"",firstDay:p.run("CalendarWebclient","getWeekStartsOn",[]),showOn:"both",buttonText:" ",dateFormat:this.dateFormatDatePicker,onSelect:t}),o(e).mousedown((function(){o("#ui-datepicker-div").toggle()}))},M.prototype.selectDatetime=function(){if(!this.lockSelectStartEndDate()){this.lockSelectStartEndDate(!0);var e=this.getDateTime(this.dateDom(),this.selectedTime()),t=a(e);this.selectedDate(this.getDateWithoutYearIfMonthWord(o(this.dateDom()).val())),this.selectedTime(t.isValid()?t.format(this.timeFormatMoment):""),this.scheduledTime(t.isValid()?t.unix():0),this.lockSelectStartEndDate(!1)}},M.prototype.getDateTime=function(e,t){t=t?a(t,this.timeFormatMoment).format("HH:mm"):"";var s=e.datepicker("getDate"),o=t?t.split(":"):[];return 2===o.length&&null!==s?(s.setHours(o[0]),s.setMinutes(o[1])):null!==s&&(s.setHours(8),s.setMinutes(0)),s},M.prototype.getDateWithoutYearIfMonthWord=function(e){var t=e.split(" "),s=a().format("YYYY");return 3===t.length&&s===t[2]?t[0]+" "+t[1]:e},M.prototype.selectScheduledTime=function(e){this.dateDom().val(""),this.selectedDate(""),this.selectedTime(""),this.scheduledTime()===e?this.scheduledTime(0):this.scheduledTime(e)},M.prototype.schedule=function(){if(i.isFunction(this.oCompose&&this.oCompose.koAllAttachmentsUploaded))if(this.oCompose.koAllAttachmentsUploaded())this.scheduleAfterAllUploaded();else var e=this.oCompose.koAllAttachmentsUploaded.subscribe((function(){this.oCompose.koAllAttachmentsUploaded()&&this.scheduleAfterAllUploaded(),e.dispose()}),this);else this.scheduleAfterAllUploaded()},M.prototype.scheduleAfterAllUploaded=function(){if(i.isFunction(this.oCompose&&this.oCompose.getSendSaveParameters)){if(this.scheduledTime()<a().unix())return void E.showError(d.i18n("MAILSCHEDULEDMESSAGES/ERROR_LATER_SCHEDULED_TIME"));var e=this.oCompose.getSendSaveParameters();e.DraftUid&&i.isFunction(this.oCompose&&this.oCompose.getDraftFolderFullName)&&(e.DraftFolder=this.oCompose.getDraftFolderFullName(e.AccountID)),e.ScheduleDateTime=this.scheduledTime(),this.scheduleInProcess(!0),u.send("MailScheduledMessages","SaveScheduledMessage",e,(function(t){this.scheduleInProcess(!1),t&&t.Result?(E.showReport(d.i18n("MAILSCHEDULEDMESSAGES/REPORT_SENDING_SCHEDULED")),this.closePopup(),p.run("MailWebclient","removeMessageFromCurrentList",[e.AccountID,e.DraftFolder,e.DraftUid]),this.oCompose&&(i.isFunction(this.oCompose.commitAndClose)&&this.oCompose.commitAndClose(),i.isFunction(this.oCompose.clearFolderCache)&&(e.DraftFolder&&this.oCompose.clearFolderCache(e.AccountID,e.DraftFolder),A.CurrentScheduledFolderName&&this.oCompose.clearFolderCache(e.AccountID,A.CurrentScheduledFolderName)))):c.showErrorByCode(t)}),this)}},M.prototype.cancelPopup=function(){this.scheduleInProcess()||this.closePopup()},M.prototype.onClose=function(){i.isFunction(this.fOnClose)&&this.fOnClose()},e.exports=new M},MYnu:(e,t,s)=>{var o=s("a7T2"),i=s("sdEb"),n=s("H20a"),a=s("KC/L"),r=s("jNBr"),l=s("vjMU"),d={};function h(e,t){var s="",o={0:n.i18n("MAILSCHEDULEDMESSAGES/LABEL_WHEN_SUNDAY"),1:n.i18n("MAILSCHEDULEDMESSAGES/LABEL_WHEN_MONDAY"),2:n.i18n("MAILSCHEDULEDMESSAGES/LABEL_WHEN_TUESDAY"),3:n.i18n("MAILSCHEDULEDMESSAGES/LABEL_WHEN_WEDNESDAY"),4:n.i18n("MAILSCHEDULEDMESSAGES/LABEL_WHEN_THURSDAY"),5:n.i18n("MAILSCHEDULEDMESSAGES/LABEL_WHEN_FRIDAY"),6:n.i18n("MAILSCHEDULEDMESSAGES/LABEL_WHEN_SATURDAY")},a=i();return s=a.date()===e.date()?n.i18n("MAILSCHEDULEDMESSAGES/LABEL_WHEN_TODAY"):a.add(1,"d").date()===e.date()?n.i18n("MAILSCHEDULEDMESSAGES/LABEL_WHEN_TOMORROW"):o[e.day()],t>=0&&t<=3?s+=" "+n.i18n("MAILSCHEDULEDMESSAGES/LABEL_WHEN_NIGHT"):t>=4&&t<=11?s+=" "+n.i18n("MAILSCHEDULEDMESSAGES/LABEL_WHEN_MORNING"):t>=12&&t<=16?s+=" "+n.i18n("MAILSCHEDULEDMESSAGES/LABEL_WHEN_AFTERNOON"):t>=16&&t<=23&&(s+=" "+n.i18n("MAILSCHEDULEDMESSAGES/LABEL_WHEN_EVENING")),s}d.getPredefinedOptions=function(){var e=[];o.isArray(l.PredefinedSchedule)&&o.each(l.PredefinedSchedule,(function(t){var s=function(e){var t=a.pInt(e.Hour);return t<=12&&a.isString(e.Hour)&&-1!==e.Hour.toLowerCase().indexOf("pm")&&(t+=12),t}(t),o=function(e,t){var s=i();if("today"===e.DayOfWeek.toLowerCase())s.set("hour",t).set("minute",0).set("second",0);else if("tomorrow"===e.DayOfWeek.toLowerCase())s.add(1,"d").set("hour",t).set("minute",0).set("second",0);else{var o=a.pInt({sunday:0,monday:1,tuesday:2,wednesday:3,thursday:4,friday:5,saturday:6}[e.DayOfWeek.toLowerCase()],1);o<=s.day()&&(o+=7),s.set("hour",t).set("minute",0).set("second",0).day(o)}return s}(t,s);e.push({LeftLabel:h(o,s),RightLabel:o.format("D MMM, "+r.prototype.getTimeFormat()),Unix:o.unix()})})),e.sort((function(e,t){return e.Unix===t.Unix?0:e.Unix<t.Unix?-1:1}));var t=[];return o.each(e,(function(e){e.Unix>i().unix()&&!o.find(t,(function(t){return e.Unix===t.Unix}))&&t.push(e)})),o.uniq(t)},d.getScheduledAtText=function(e){var t=i.unix(e);return n.i18n("MAILSCHEDULEDMESSAGES/INFO_SENDING_SCHEDULED_FOR",{DATA:t.format("D MMM, "+r.prototype.getTimeFormat())})},e.exports=d},"6Z3g":(e,t,s)=>{var o=s("a7T2"),i=s("p09A"),n=s("H20a"),a=s("REt5"),r=s("hT1I"),l=s("oUN1"),d=s("VANH");function h(){this.bSendButton=!0,this.oCompose=null,this.disableAutosave=i.observable(!1)}h.prototype.ViewTemplate="MailScheduledMessages_ComposeSendButtonView",h.prototype.assignComposeExtInterface=function(e){this.oCompose=e,this.scheduleCommand=a.createCommand(this,this.scheduleSending,function(){return!!this.oCompose&&this.oCompose.isEnableSending()&&this.oCompose.isEnableSaving()}.bind(this))},h.prototype.scheduleSending=function(){o.isFunction(this.oCompose&&this.oCompose.getAutoEncryptSignMessage)&&this.oCompose.getAutoEncryptSignMessage()?l.showPopup(r,[n.i18n("MAILSCHEDULEDMESSAGES/ERROR_AUTOMATIC_ENCRYPTION")]):o.isFunction(this.oCompose&&this.oCompose.getRecipientsEmpty)&&this.oCompose.getRecipientsEmpty()?l.showPopup(r,[n.i18n("MAILSCHEDULEDMESSAGES/ERROR_RECIPIENTS_EMPTY")]):(this.disableAutosave(!0),l.showPopup(d,[this.oCompose,function(){this.disableAutosave(!1)}.bind(this)]))},e.exports=new h},Wmfn:(e,t,s)=>{var o=s("a7T2"),i=s("p09A"),n=s("H20a"),a=s("KC/L"),r=(s("hT1I"),s("9kOp")),l=s("TdEd"),d=s("oUN1"),h=s("skxT"),u=s("B5X4"),c=s("0I4a"),m=s("MYnu"),p=s("vjMU");function E(){this.iAccountId=0,this.sFolderFullName="",this.sMessageUid="",this.scheduledText=i.observable(""),this.visible=i.observable(!1),this.disableAllSendTools=i.computed((function(){return this.visible()}),this),this.oMessagePane=null,this.bWaitDraftSaving=!1,r.subscribeEvent("MailWebclient::ComposeMessageLoaded",function(e){this.iAccountId===e.AccountId&&this.sFolderFullName===e.FolderFullName&&this.sMessageUid===e.MessageUid&&(this.bWaitDraftSaving=!0,e.Compose.executeSaveCommand())}.bind(this)),r.subscribeEvent("ReceiveAjaxResponse::after",function(e){this.bWaitDraftSaving&&"Mail"===e.Request.Module&&"SaveMessage"===e.Request.Method&&(this.bWaitDraftSaving=!1,l.run("MailWebclient","deleteMessages",[this.iAccountId,this.sFolderFullName,[this.sMessageUid]]),h.showReport(n.i18n("MAILSCHEDULEDMESSAGES/REPORT_SENDING_CANCELED")))}.bind(this))}E.prototype.ViewTemplate="MailScheduledMessages_ScheduledInfoView",E.prototype.doAfterPopulatingMessage=function(e){if(this.bWaitDraftSaving=!1,this.iAccountId=0,this.sFolderFullName="",this.sMessageUid="",this.scheduledText(""),this.visible(!1),e&&e.sFolderFullName===p.CurrentScheduledFolderName){var t=a.pArray(e.aExtend),s=o.find(t,(function(e){return a.isPositiveNumber(e.ScheduleTimestamp)}));s&&(this.iAccountId=e.iAccountId,this.sFolderFullName=e.sFolderFullName,this.sMessageUid=e.sMessageUid,this.scheduledText(m.getScheduledAtText(s.ScheduleTimestamp)),this.visible(!0))}},E.prototype.cancelSending=function(){if(0!==this.iAccountId){var e=d.getOpenedMinimizedPopup("MailWebclient_ComposePopup");e&&e.hasUnsavedChanges()?(e.maximize(),e.disableAutosave(!0),d.showPopup(c,[function(t){switch(t){case Enums.AnotherMessageComposedAnswer.Discard:e.commit(),u.composeMessageFromDrafts(this.iAccountId,this.sFolderFullName,this.sMessageUid);break;case Enums.AnotherMessageComposedAnswer.SaveAsDraft:e.hasUnsavedChanges()&&e.executeSave(!0,!1),u.composeMessageFromDrafts(this.iAccountId,this.sFolderFullName,this.sMessageUid);break;case Enums.AnotherMessageComposedAnswer.Cancel:h.showLoading(n.i18n("MAILSCHEDULEDMESSAGES/ERROR_SENDING_CANCELED")),setTimeout((function(){h.hideLoading()}),1e4)}e.disableAutosave(!1)}.bind(this)])):u.composeMessageFromDrafts(this.iAccountId,this.sFolderFullName,this.sMessageUid)}},e.exports=new E}}]);