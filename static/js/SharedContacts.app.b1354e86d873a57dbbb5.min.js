"use strict";(self.webpackChunkafterlogic_aurora_platform=self.webpackChunkafterlogic_aurora_platform||[]).push([[9139],{"8jKl":(e,s,t)=>{var o=t("M4cL");e.exports=function(e){return t("9kOp").isUserNormalOrTenant()?{start:function(){o("html").addClass("shared-addressbooks")},getShareAddressbookControlView:function(){return t("5cRz")}}:null}},dxpi:(e,s,t)=>{var o=t("p09A"),a=t("H20a"),i=t("KC/L");e.exports=function(e){this.publicId=i.pString(e.PublicId),this.groupId=i.pInt(e.GroupId),this.isAllUsersGroup=i.pBool(e.IsAll),this.access=o.observable(i.pInt(e.Access)),this.accessText=o.computed((function(){switch(this.access()){case Enums.SharedAddressbookAccess.Write:return a.i18n("SHAREDCONTACTS/LABEL_WRITE_ACCESS");case Enums.SharedAddressbookAccess.Read:return a.i18n("SHAREDCONTACTS/LABEL_READ_ACCESS");case Enums.SharedAddressbookAccess.NoAccess:return a.i18n("SHAREDCONTACTS/LABEL_NOSHARE_ACCESS")}}),this)}},"7EGo":(e,s,t)=>{var o=t("M4cL"),a=t("a7T2"),i=t("p09A"),r=t("H20a"),n=t("KC/L"),h=t("EFhx"),c=t("hT1I"),d=t("/QeJ"),l=t("9kOp"),u=t("o1lX"),p=t("XeMN"),m=t("TdEd"),S=t("oUN1"),A=t("skxT"),T=t("dxpi");function b(){u.call(this),this.addressbook=null,this.accessList=i.computed((function(){return[{value:Enums.SharedAddressbookAccess.Read,label:r.i18n("SHAREDCONTACTS/LABEL_READ_ACCESS")},{value:Enums.SharedAddressbookAccess.Write,label:r.i18n("SHAREDCONTACTS/LABEL_WRITE_ACCESS")},{value:Enums.SharedAddressbookAccess.NoAccess,label:r.i18n("SHAREDCONTACTS/LABEL_NOSHARE_ACCESS")}]}),this),this.shares=i.observableArray([]),this.sharesScrollAreaDom=i.observable(null),this.selectedTeammateDom=i.observable(null),this.selectedTeammateDom.subscribe((function(){this.selectedTeammateDom().on("click",function(){""!==this.selectedTeammateEmail()&&(o(this.selectedTeammateDom().autocomplete("widget")).is(":visible")||this.selectedTeammateDom().autocomplete("search"))}.bind(this))}),this),this.selectedTeammateEmail=i.observable(""),this.selectedTeammateData=i.observable(null),this.selectedTeammateData.subscribe((function(){this.selectedTeammateData()&&this.selectedTeammateEmail(this.selectedTeammateData().email)}),this),this.selectAccessDom=i.observable(null),this.lastRecievedSuggestList=[],this.isSaving=i.observable(!1),this.loadingAddressbookShares=i.observable(!1)}a.extendOwn(b.prototype,u.prototype),b.prototype.PopupTemplate="SharedContacts_AddressbookSharePopup",b.prototype.onOpen=function(e=null){null!==e?(this.addressbook=e,this.selectedTeammateEmail(""),this.selectedTeammateData(null),this.fillUpShares(),this.requestAddressbookShares(function(e){this.updateAddressbookShares(e),this.fillUpShares()}.bind(this))):this.closePopup()},b.prototype.fillUpShares=function(){const e=n.pArray(this.addressbook&&this.addressbook.Shares);this.shares(a.map(e,(function(e){return new T(e)})))},b.prototype.requestAddressbookShares=function(e){const s={Id:this.addressbook.Id};this.loadingAddressbookShares(!0),h.send("SharedContacts","GetSharesForAddressbook",s,function(s,t){this.loadingAddressbookShares(!1);const o=s&&s.Result;e(o||[])}.bind(this))},b.prototype.updateAddressbookShares=function(e){this.addressbook&&(this.addressbook.Shares=n.pArray(e))},b.prototype.getCurrentShares=function(){return a.map(this.shares(),(function(e){const s=e.access();return e.groupId?{PublicId:e.publicId,Access:s,IsAll:e.isAllUsersGroup,IsGroup:!0,GroupId:e.groupId}:{PublicId:e.publicId,Access:s}}),this)},b.prototype.hasChanges=function(){var e=this.addressbook,s=n.pArray(e&&e.Shares),t=this.getCurrentShares();return s=a.sortBy(s,"PublicId"),t=a.sortBy(t,"PublicId"),e&&(!a.isEqual(s,t)||this.selectedTeammateEmail())},b.prototype.onEscHandler=function(){this.cancelPopup()},b.prototype.cancelPopup=function(){this.isSaving()||(this.hasChanges()?S.showPopup(p,[r.i18n("COREWEBCLIENT/CONFIRM_DISCARD_CHANGES"),function(e){e&&this.closePopup()}.bind(this)]):this.closePopup())},b.prototype.autocompleteCallback=function(e,s){if(this.addressbook,!this.addressbook)return void fResponse([]);const t=l.getUserPublicId(),o={storage:"team",addContactGroups:!1,addUserGroups:!0,exceptEmail:t},i=m.run("ContactsWebclient","getSuggestionsAutocompleteCallback",[o]),n=function(e){const o=t.toLowerCase(),a=e.filter((e=>{const s=e.email.toLowerCase();return o!==s&&!this.shares().find((e=>e.publicId.toLowerCase()===s))}));this.lastRecievedSuggestList=a,a.length>0?s(a):s([{label:r.i18n("SHAREDCONTACTS/INFO_NO_SUGGESTED_CONTACTS"),disabled:!0}])}.bind(this);a.isFunction(i)&&(this.selectedTeammateData(null),i(e,n))},b.prototype.selectAccess=function(e,s){if(this.selectAccessDom().hasClass("expand"))this.selectAccessDom().removeClass("expand");else{if(null===this.selectedTeammateData()){var t=this.selectedTeammateEmail(),o=t.toLowerCase();if(""===t){var i=r.i18n("SHAREDCONTACTS/WARNING_SELECT_TEAMMATE"),n=function(){this.selectedTeammateDom().focus(),this.selectedTeammateDom().autocomplete("option","minLength",0),this.selectedTeammateDom().autocomplete("search"),this.selectedTeammateDom().autocomplete("option","minLength",1)}.bind(this);S.showPopup(c,[i,n])}else{var h=a.find(this.lastRecievedSuggestList,function(e){return e.value.toLowerCase()===o||e.email.toLowerCase()===o||e.name.toLowerCase()===o}.bind(this));if(h)this.selectedTeammateData(h);else if(h=a.find(this.lastRecievedSuggestList,function(e){return-1!==e.value.toLowerCase().indexOf(o)}.bind(this))){var d=r.i18n("SHAREDCONTACTS/CONFIRM_ADD_TEAMMATE",{EMAIL:h.email}),l=function(e){e?(this.selectedTeammateEmail(h.email),this.selectedTeammateData(h),this.selectAccessDom().addClass("expand")):(this.selectedTeammateDom().focus(),this.selectedTeammateDom().autocomplete("search"))}.bind(this),u=r.i18n("SHAREDCONTACTS/ACTION_YES"),m=r.i18n("SHAREDCONTACTS/ACTION_NO");S.showPopup(p,[d,l,"",u,m])}else i=r.i18n("SHAREDCONTACTS/WARNING_NO_TEAMMATE_SELECTED",{EMAIL:t}),n=function(){this.selectedTeammateDom().focus(),this.selectedTeammateDom().autocomplete("search")}.bind(this),S.showPopup(c,[i,n])}}null!==this.selectedTeammateData()&&this.selectAccessDom().addClass("expand")}},b.prototype.addNewShare=function(e){if(!this.selectedTeammateData())return this.selectedTeammateDom().focus(),void this.selectedTeammateDom().autocomplete("search");this.shares.push(new T({PublicId:this.selectedTeammateData().email,GroupId:this.selectedTeammateData().groupId,IsAll:this.selectedTeammateData().isAllUsersGroup,Access:e})),this.selectedTeammateData(null),this.selectedTeammateEmail("");var s=this.sharesScrollAreaDom(),t=null!==s?s.find(".shares_list"):null;null!==t&&s.scrollTop(t.height()-s.height())},b.prototype.deleteShare=function(e,s){s?this.shares(a.filter(this.shares(),(function(e){return e.groupId!==s}))):this.shares(a.filter(this.shares(),(function(s){return s.publicId!==e})))},b.prototype.checkAndSaveShares=function(){this.isSaving()||(this.isSaving(!0),this.requestAddressbookShares(function(e){this.isSaving(!1);const s=this.addressbook;let t=n.pArray(s&&s.Shares);if(e=a.sortBy(e,"PublicId"),t=a.sortBy(t,"PublicId"),a.isEqual(t,e))this.saveShares();else{const s=r.i18n("SHAREDCONTACTS/WARNING_SHARES_CHANGED_BY_OTHER_USER"),t=function(){this.updateAddressbookShares(e),this.fillUpShares()}.bind(this);S.showPopup(c,[s,t])}}.bind(this)))},b.prototype.saveShares=function(){if(!this.isSaving())if(this.selectedTeammateEmail()){var e=r.i18n("SHAREDCONTACTS/CONFIRM_SAVE_SHARES_WITHOUT_LAST_EMAIL",{EMAIL:this.selectedTeammateEmail()}),s=function(e){e?this.confirmedSaveShares():setTimeout(this.selectAccess.bind(this))}.bind(this);S.showPopup(p,[e,s])}else this.confirmedSaveShares()},b.prototype.confirmedSaveShares=function(){if(this.isSaving())return;const e=this.getCurrentShares(),s={Id:this.addressbook.Id,Shares:e};this.isSaving(!0),h.send("SharedContacts","UpdateAddressbookShare",s,a.bind(this.onUpdateShareResponse,this))},b.prototype.onUpdateShareResponse=function(e,s){this.isSaving(!1),e.Result?this.requestAddressbookShares(function(e){this.updateAddressbookShares(e),A.showReport(r.i18n("SHAREDCONTACTS/INFO_SHARING_STATUS_UPDATED")),this.addressbook=null,this.closePopup()}.bind(this)):d.showErrorByCode(e)},e.exports=new b},"5cRz":(e,s,t)=>{const o=t("H20a"),a=t("EFhx"),i=t("/QeJ"),r=t("XeMN"),n=t("oUN1"),h=t("7EGo");function c(){}c.prototype.ViewTemplate="SharedContacts_ShareAddressbookControlView",c.prototype.openAddressbookSharePopup=function(e){h&&e&&n.showPopup(h,[e])},c.prototype.leaveAddressbookShare=function(e){const s=e.DisplayName||"",t=o.i18n("SHAREDCONTACTS/CONFIRM_LEAVE_SHARE",{NAME:s}),a=this.confirmedLeaveShare.bind(this,e),i=o.i18n("SHAREDCONTACTS/ACTION_LEAVE_SHARE");n.showPopup(r,[t,a,"",i])},c.prototype.confirmedLeaveShare=function(e,s){if(s){const s={Id:e.Id};a.send("SharedContacts","LeaveShare",s,this.onLeaveShareResponse,this)}},c.prototype.onLeaveShareResponse=function(e,s){e&&e.Result?a.send("Contacts","GetStorages"):i.showErrorByCode(e)},e.exports=new c}}]);